"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[29591],{15680:(e,t,n)=>{n.d(t,{xA:()=>p,yg:()=>u});var i=n(96540);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=i.createContext({}),d=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=d(e.components);return i.createElement(s.Provider,{value:t},e.children)},g="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},h=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,p=r(e,["components","mdxType","originalType","parentName"]),g=d(n),h=a,u=g["".concat(s,".").concat(h)]||g[h]||c[h]||o;return n?i.createElement(u,l(l({ref:t},p),{},{components:n})):i.createElement(u,l({ref:t},p))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,l=new Array(o);l[0]=h;var r={};for(var s in t)hasOwnProperty.call(t,s)&&(r[s]=t[s]);r.originalType=e,r[g]="string"==typeof e?e:a,l[1]=r;for(var d=2;d<o;d++)l[d]=n[d];return i.createElement.apply(null,l)}return i.createElement.apply(null,n)}h.displayName="MDXCreateElement"},40715:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>c,frontMatter:()=>o,metadata:()=>r,toc:()=>d});var i=n(58168),a=(n(96540),n(15680));const o={description:"This tutorial describes how to use the microSD card and file system on the XIAO ESP32S3.",title:"MicroSD card for Sense Version",keywords:["xiao esp32s3","esp32s3","tf","sd","file"],image:"https://files.seeedstudio.com/wiki/seeed_logo/logo_2023.png",slug:"/xiao_esp32s3_sense_filesystem",last_update:{date:"04/11/2023",author:"Citric"}},l="File System and XIAO ESP32S3 Sense",r={unversionedId:"Sensor/SeeedStudio_XIAO/SeeedStudio_XIAO_ESP32S3_Sense/XIAO_ESP32S3_Sense_tf_and_filesystem",id:"Sensor/SeeedStudio_XIAO/SeeedStudio_XIAO_ESP32S3_Sense/XIAO_ESP32S3_Sense_tf_and_filesystem",title:"MicroSD card for Sense Version",description:"This tutorial describes how to use the microSD card and file system on the XIAO ESP32S3.",source:"@site/docs/Sensor/SeeedStudio_XIAO/SeeedStudio_XIAO_ESP32S3_Sense/XIAO_ESP32S3_Sense_tf_and_filesystem.md",sourceDirName:"Sensor/SeeedStudio_XIAO/SeeedStudio_XIAO_ESP32S3_Sense",slug:"/xiao_esp32s3_sense_filesystem",permalink:"/xiao_esp32s3_sense_filesystem",draft:!1,editUrl:"https://github.com/Seeed-Studio/wiki-documents/blob/docusaurus-version/docs/Sensor/SeeedStudio_XIAO/SeeedStudio_XIAO_ESP32S3_Sense/XIAO_ESP32S3_Sense_tf_and_filesystem.md",tags:[],version:"current",lastUpdatedBy:"Citric",lastUpdatedAt:1681171200,formattedLastUpdatedAt:"Apr 11, 2023",frontMatter:{description:"This tutorial describes how to use the microSD card and file system on the XIAO ESP32S3.",title:"MicroSD card for Sense Version",keywords:["xiao esp32s3","esp32s3","tf","sd","file"],image:"https://files.seeedstudio.com/wiki/seeed_logo/logo_2023.png",slug:"/xiao_esp32s3_sense_filesystem",last_update:{date:"04/11/2023",author:"Citric"}},sidebar:"ProductSidebar",previous:{title:"Microphone Usage for Sense Version",permalink:"/xiao_esp32s3_sense_mic"},next:{title:"Camera Usage for Sense Version",permalink:"/xiao_esp32s3_camera_usage"}},s={},d=[{value:"Getting Started",id:"getting-started",level:2},{value:"Installation of expansion boards (for Sense)",id:"installation-of-expansion-boards-for-sense",level:3},{value:"Prepare the microSD card",id:"prepare-the-microsd-card",level:3},{value:"Card slot circuit design for expansion boards",id:"card-slot-circuit-design-for-expansion-boards",level:3},{value:"Modify the files in the microSD card",id:"modify-the-files-in-the-microsd-card",level:2},{value:"Program annotation",id:"program-annotation",level:3},{value:"MicroSD card application based on gas data logging",id:"microsd-card-application-based-on-gas-data-logging",level:2},{value:"Program annotation",id:"program-annotation-1",level:3},{value:"Serial Peripheral Interface Flash File System (SPIFFS)",id:"serial-peripheral-interface-flash-file-system-spiffs",level:2},{value:"Installing the Arduino ESP32 Filesystem Uploader",id:"installing-the-arduino-esp32-filesystem-uploader",level:3},{value:"Windows",id:"windows",level:4},{value:"MacOS",id:"macos",level:4},{value:"Uploading Files using the Filesystem Uploader",id:"uploading-files-using-the-filesystem-uploader",level:3},{value:"Testing the Uploader",id:"testing-the-uploader",level:3},{value:"Flash Data Storage",id:"flash-data-storage",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Citations &amp; References",id:"citations--references",level:2},{value:"Tech Support &amp; Product Discussion",id:"tech-support--product-discussion",level:2}],p={toc:d},g="wrapper";function c(e){let{components:t,...n}=e;return(0,a.yg)(g,(0,i.A)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.yg)("h1",{id:"file-system-and-xiao-esp32s3-sense"},"File System and XIAO ESP32S3 Sense"),(0,a.yg)("p",null,"In this tutorial, we will focus on the use of the file system of XIAO ESP32S3, mainly on the use of the microSD card slot for the Sense version. At the same time, we will introduce the official ESP file system SPIFFS, the chip's built-in Flash, etc."),(0,a.yg)("admonition",{type:"tip"},(0,a.yg)("p",{parentName:"admonition"},"The microSD card part of this tutorial ",(0,a.yg)("strong",{parentName:"p"},"only")," applies to the ",(0,a.yg)("strong",{parentName:"p"},"XIAO ESP32S3 Sense"),", the rest of the content applies to the ESP32-S3 chip, so you can run the examples on the XIAO ESP32S3 except for the microSD card.")),(0,a.yg)("div",{class:"table-center"},(0,a.yg)("table",{align:"center"},(0,a.yg)("tr",null,(0,a.yg)("th",null,"Seeed Studio XIAO ESP32S3"),(0,a.yg)("th",null,"Seeed Studio XIAO ESP32S3 Sense")),(0,a.yg)("tr",null,(0,a.yg)("td",null,(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/SeeedStudio-XIAO-ESP32S3/img/xiaoesp32s3.jpg",style:{width:250,height:"auto"}}))),(0,a.yg)("td",null,(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/SeeedStudio-XIAO-ESP32S3/img/xiaoesp32s3sense.jpg",style:{width:250,height:"auto"}})))),(0,a.yg)("tr",null,(0,a.yg)("td",null,(0,a.yg)("div",{class:"get_one_now_container",style:{textAlign:"center"}},(0,a.yg)("a",{class:"get_one_now_item",href:"https://www.seeedstudio.com/XIAO-ESP32S3-p-5627.html"},(0,a.yg)("strong",null,(0,a.yg)("span",null,(0,a.yg)("font",{color:"FFFFFF",size:"4"}," Get One Now \ud83d\uddb1\ufe0f")))))),(0,a.yg)("td",null,(0,a.yg)("div",{class:"get_one_now_container",style:{textAlign:"center"}},(0,a.yg)("a",{class:"get_one_now_item",href:"https://www.seeedstudio.com/XIAO-ESP32S3-Sense-p-5639.html"},(0,a.yg)("strong",null,(0,a.yg)("span",null,(0,a.yg)("font",{color:"FFFFFF",size:"4"}," Get One Now \ud83d\uddb1\ufe0f"))))))))),(0,a.yg)("h2",{id:"getting-started"},"Getting Started"),(0,a.yg)("p",null,"Since the microSD card will be used in this tutorial, we need to install the Sense expansion board and prepare the microSD card in advance."),(0,a.yg)("h3",{id:"installation-of-expansion-boards-for-sense"},"Installation of expansion boards (for Sense)"),(0,a.yg)("p",null,'Installing the expansion board is very simple, you just need to align the connector on the expansion board with the B2B connector on the XIAO ESP32S3, press it hard and hear a "click", the installation is complete.'),(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/SeeedStudio-XIAO-ESP32S3/img/61.gif",style:{width:500,height:"auto"}})),(0,a.yg)("h3",{id:"prepare-the-microsd-card"},"Prepare the microSD card"),(0,a.yg)("p",null,"XIAO ESP32S3 Sense supports microSD cards up to ",(0,a.yg)("strong",{parentName:"p"},"32GB"),", so if you are ready to buy a microSD card for XIAO, please refer to this specification. And format the microSD card to ",(0,a.yg)("strong",{parentName:"p"},"FAT32")," format before using the microSD card."),(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/SeeedStudio-XIAO-ESP32S3/img/67.png",style:{width:250,height:"auto"}})),(0,a.yg)("p",null,"After formatting, you can insert the microSD card into the microSD card slot. Please note the direction of insertion, the side with the gold finger should face inward."),(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/SeeedStudio-XIAO-ESP32S3/img/66.jpg",style:{width:500,height:"auto"}})),(0,a.yg)("h3",{id:"card-slot-circuit-design-for-expansion-boards"},"Card slot circuit design for expansion boards"),(0,a.yg)("p",null,"The XIAO ESP32S3 Sense card slot occupies 4 GPIOs of the ESP32-S3, and the pin details of the occupancy are shown in the table below."),(0,a.yg)("div",{class:"table-center"},(0,a.yg)("table",{align:"center"},(0,a.yg)("tr",null,(0,a.yg)("th",{align:"center"},"ESP32-S3 GPIO"),(0,a.yg)("th",{align:"center"},"microSD Card Slot")),(0,a.yg)("tr",null,(0,a.yg)("td",{align:"center"},"GPIO21"),(0,a.yg)("td",{align:"center"},"CS")),(0,a.yg)("tr",null,(0,a.yg)("td",{align:"center"},"D8 / A8 / Qt7 / GPIO7"),(0,a.yg)("td",{align:"center"},"SCK")),(0,a.yg)("tr",null,(0,a.yg)("td",{align:"center"},"D9 / A9 / Qt8 / GPIO8"),(0,a.yg)("td",{align:"center"},"MISO")),(0,a.yg)("tr",null,(0,a.yg)("td",{align:"center"},"D10 / A10 / Qt9 / GPIO9"),(0,a.yg)("td",{align:"center"},"MOSI")))),(0,a.yg)("p",null,"This also means that if you choose to use the microSD card function of the expansion board, you cannot also use the SPI function of the XIAO ESP32S3. You can turn on/off the microSD card function by connecting/cutting the pads of J3."),(0,a.yg)("table",{align:"center"},(0,a.yg)("tr",null,(0,a.yg)("th",null,"If you want to use the SPI Pins / Disable the SD card of the expansion board"),(0,a.yg)("th",null,"If you want to enable the SD card on the expansion board / Disable the SPI Pins")),(0,a.yg)("tr",null,(0,a.yg)("td",null,(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/SeeedStudio-XIAO-ESP32S3/img/33.png",style:{width:300,height:"auto"}}))),(0,a.yg)("td",null,(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/SeeedStudio-XIAO-ESP32S3/img/36.JPG",style:{width:300,height:"auto"}})))),(0,a.yg)("tr",null,(0,a.yg)("td",null,"Cut along the white thin line to disconnect the solder pad connection."),(0,a.yg)("td",null,"Solder the two solder pads together."))),(0,a.yg)("admonition",{type:"tip"},(0,a.yg)("p",{parentName:"admonition"},"By default, the microSD card function is enabled after the expansion board is installed.")),(0,a.yg)("h2",{id:"modify-the-files-in-the-microsd-card"},"Modify the files in the microSD card"),(0,a.yg)("admonition",{type:"caution"},(0,a.yg)("p",{parentName:"admonition"},"This section applies to XIAO ESP32S3 Sense only.")),(0,a.yg)("p",null,"There are several examples in Arduino IDE that show how to handle files on the microSD card using the XIAO ESP32S3. In the Arduino IDE, go to ",(0,a.yg)("strong",{parentName:"p"},"File > Examples > SD > SD_Test"),", or copy the following code."),(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/SeeedStudio-XIAO-ESP32S3/img/68.png",style:{width:700,height:"auto"}})),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},'#include "FS.h"\n#include "SD.h"\n#include "SPI.h"\n\nvoid listDir(fs::FS &fs, const char * dirname, uint8_t levels){\n    Serial.printf("Listing directory: %s\\n", dirname);\n\n    File root = fs.open(dirname);\n    if(!root){\n        Serial.println("Failed to open directory");\n        return;\n    }\n    if(!root.isDirectory()){\n        Serial.println("Not a directory");\n        return;\n    }\n\n    File file = root.openNextFile();\n    while(file){\n        if(file.isDirectory()){\n            Serial.print("  DIR : ");\n            Serial.println(file.name());\n            if(levels){\n                listDir(fs, file.path(), levels -1);\n            }\n        } else {\n            Serial.print("  FILE: ");\n            Serial.print(file.name());\n            Serial.print("  SIZE: ");\n            Serial.println(file.size());\n        }\n        file = root.openNextFile();\n    }\n}\n\nvoid createDir(fs::FS &fs, const char * path){\n    Serial.printf("Creating Dir: %s\\n", path);\n    if(fs.mkdir(path)){\n        Serial.println("Dir created");\n    } else {\n        Serial.println("mkdir failed");\n    }\n}\n\nvoid removeDir(fs::FS &fs, const char * path){\n    Serial.printf("Removing Dir: %s\\n", path);\n    if(fs.rmdir(path)){\n        Serial.println("Dir removed");\n    } else {\n        Serial.println("rmdir failed");\n    }\n}\n\nvoid readFile(fs::FS &fs, const char * path){\n    Serial.printf("Reading file: %s\\n", path);\n\n    File file = fs.open(path);\n    if(!file){\n        Serial.println("Failed to open file for reading");\n        return;\n    }\n\n    Serial.print("Read from file: ");\n    while(file.available()){\n        Serial.write(file.read());\n    }\n    file.close();\n}\n\nvoid writeFile(fs::FS &fs, const char * path, const char * message){\n    Serial.printf("Writing file: %s\\n", path);\n\n    File file = fs.open(path, FILE_WRITE);\n    if(!file){\n        Serial.println("Failed to open file for writing");\n        return;\n    }\n    if(file.print(message)){\n        Serial.println("File written");\n    } else {\n        Serial.println("Write failed");\n    }\n    file.close();\n}\n\nvoid appendFile(fs::FS &fs, const char * path, const char * message){\n    Serial.printf("Appending to file: %s\\n", path);\n\n    File file = fs.open(path, FILE_APPEND);\n    if(!file){\n        Serial.println("Failed to open file for appending");\n        return;\n    }\n    if(file.print(message)){\n        Serial.println("Message appended");\n    } else {\n        Serial.println("Append failed");\n    }\n    file.close();\n}\n\nvoid renameFile(fs::FS &fs, const char * path1, const char * path2){\n    Serial.printf("Renaming file %s to %s\\n", path1, path2);\n    if (fs.rename(path1, path2)) {\n        Serial.println("File renamed");\n    } else {\n        Serial.println("Rename failed");\n    }\n}\n\nvoid deleteFile(fs::FS &fs, const char * path){\n    Serial.printf("Deleting file: %s\\n", path);\n    if(fs.remove(path)){\n        Serial.println("File deleted");\n    } else {\n        Serial.println("Delete failed");\n    }\n}\n\nvoid testFileIO(fs::FS &fs, const char * path){\n    File file = fs.open(path);\n    static uint8_t buf[512];\n    size_t len = 0;\n    uint32_t start = millis();\n    uint32_t end = start;\n    if(file){\n        len = file.size();\n        size_t flen = len;\n        start = millis();\n        while(len){\n            size_t toRead = len;\n            if(toRead > 512){\n                toRead = 512;\n            }\n            file.read(buf, toRead);\n            len -= toRead;\n        }\n        end = millis() - start;\n        Serial.printf("%u bytes read for %u ms\\n", flen, end);\n        file.close();\n    } else {\n        Serial.println("Failed to open file for reading");\n    }\n\n\n    file = fs.open(path, FILE_WRITE);\n    if(!file){\n        Serial.println("Failed to open file for writing");\n        return;\n    }\n\n    size_t i;\n    start = millis();\n    for(i=0; i<2048; i++){\n        file.write(buf, 512);\n    }\n    end = millis() - start;\n    Serial.printf("%u bytes written for %u ms\\n", 2048 * 512, end);\n    file.close();\n}\n\nvoid setup(){\n    Serial.begin(115200);\n    while(!Serial);\n    if(!SD.begin(21)){\n        Serial.println("Card Mount Failed");\n        return;\n    }\n    uint8_t cardType = SD.cardType();\n\n    if(cardType == CARD_NONE){\n        Serial.println("No SD card attached");\n        return;\n    }\n\n    Serial.print("SD Card Type: ");\n    if(cardType == CARD_MMC){\n        Serial.println("MMC");\n    } else if(cardType == CARD_SD){\n        Serial.println("SDSC");\n    } else if(cardType == CARD_SDHC){\n        Serial.println("SDHC");\n    } else {\n        Serial.println("UNKNOWN");\n    }\n\n    uint64_t cardSize = SD.cardSize() / (1024 * 1024);\n    Serial.printf("SD Card Size: %lluMB\\n", cardSize);\n\n    listDir(SD, "/", 0);\n    createDir(SD, "/mydir");\n    listDir(SD, "/", 0);\n    removeDir(SD, "/mydir");\n    listDir(SD, "/", 2);\n    writeFile(SD, "/hello.txt", "Hello ");\n    appendFile(SD, "/hello.txt", "World!\\n");\n    readFile(SD, "/hello.txt");\n    deleteFile(SD, "/foo.txt");\n    renameFile(SD, "/hello.txt", "/foo.txt");\n    readFile(SD, "/foo.txt");\n    testFileIO(SD, "/test.txt");\n    Serial.printf("Total space: %lluMB\\n", SD.totalBytes() / (1024 * 1024));\n    Serial.printf("Used space: %lluMB\\n", SD.usedBytes() / (1024 * 1024));\n}\n\nvoid loop(){\n\n}\n')),(0,a.yg)("admonition",{type:"caution"},(0,a.yg)("p",{parentName:"admonition"},"Note that you cannot use the sample program directly, you will need to make minor modifications to the program to ensure that it works. The modification is to change the original code from ",(0,a.yg)("inlineCode",{parentName:"p"},"SD.begin()")," to ",(0,a.yg)("inlineCode",{parentName:"p"},"SD.begin(21)")," in the ",(0,a.yg)("inlineCode",{parentName:"p"},"Setup()")," function. Specify the pin number for initialization.")),(0,a.yg)("p",null,"Upload the program to XIAO ESP32S3 Sense, open the serial monitor, and you will see the file creation process and the writing process. You can also use microSD to USB to access the newly created files and contents through your computer."),(0,a.yg)("div",{class:"table-center"},(0,a.yg)("table",{align:"center"},(0,a.yg)("tr",null,(0,a.yg)("td",{align:"center"},(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/SeeedStudio-XIAO-ESP32S3/img/65.png",style:{width:500,height:"auto"}}))),(0,a.yg)("td",{align:"center"},(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/SeeedStudio-XIAO-ESP32S3/img/69.png",style:{width:500,height:"auto"}})))))),(0,a.yg)("h3",{id:"program-annotation"},"Program annotation"),(0,a.yg)("p",null,"First, you need to include the following libraries: ",(0,a.yg)("strong",{parentName:"p"},"FS.h")," to handle files, ",(0,a.yg)("strong",{parentName:"p"},"SD.h")," to interface with the microSDcard and ",(0,a.yg)("strong",{parentName:"p"},"SPI.h")," to use SPI communication protocol."),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("p",{parentName:"li"},"In the ",(0,a.yg)("inlineCode",{parentName:"p"},"setup()"),", the following lines initialize the microSDcard with ",(0,a.yg)("inlineCode",{parentName:"p"},"SD.begin(21)"),". Here, we need to pass a parameter for ",(0,a.yg)("inlineCode",{parentName:"p"},"SD.begin()"),", which is the CS pin. And for the microSD card design of the expansion board, the CS pin is connected to ",(0,a.yg)("strong",{parentName:"p"},"GPIO 21"),". If you are using Round Display for XIAO, then the parameter passed in should be ",(0,a.yg)("strong",{parentName:"p"},"D2"),".")),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("p",{parentName:"li"},"The following lines print the microSDcard type on the Serial Monitor."))),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-c"},'uint8_t cardType = SD.cardType();\n\nif(cardType == CARD_NONE){\n    Serial.println("No SD card attached");\n    return;\n}\n\nSerial.print("SD Card Type: ");\nif(cardType == CARD_MMC){\n    Serial.println("MMC");\n} else if(cardType == CARD_SD){\n    Serial.println("SDSC");\n} else if(cardType == CARD_SDHC){\n    Serial.println("SDHC");\n} else {\n    Serial.println("UNKNOWN");\n}\n')),(0,a.yg)("ol",{start:3},(0,a.yg)("li",{parentName:"ol"},"You can get the microSDcard size by calling the ",(0,a.yg)("inlineCode",{parentName:"li"},"cardSize()")," method:")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-c"},'uint64_t cardSize = SD.cardSize() / (1024 * 1024);\nSerial.printf("SD Card Size: %lluMB\\n", cardSize);\n')),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"The example provides several functions to handle files on the microSDcard.")),(0,a.yg)("ol",{start:4},(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("p",{parentName:"li"},"The ",(0,a.yg)("inlineCode",{parentName:"p"},"listDir()")," function lists the directories on the SD card. This function accepts as arguments the filesystem (SD), the main directory\u2019s name, and the levels to go into the directory."),(0,a.yg)("p",{parentName:"li"},"Here\u2019s an example of how to call this function. The ",(0,a.yg)("inlineCode",{parentName:"p"},"/")," corresponds to the microSDcard root directory."))),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-c"},'listDir(SD, "/", 0);\n')),(0,a.yg)("ol",{start:5},(0,a.yg)("li",{parentName:"ol"},"The ",(0,a.yg)("inlineCode",{parentName:"li"},"createDir()")," function creates a new directory. Pass as an argument the ",(0,a.yg)("inlineCode",{parentName:"li"},"SD")," filesystem and the directory name path. For example, the following command creates a new directory on the root called ",(0,a.yg)("inlineCode",{parentName:"li"},"mydir"),".")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-c"},'createDir(SD, "/mydir");\n')),(0,a.yg)("ol",{start:6},(0,a.yg)("li",{parentName:"ol"},"To remove a directory from the microSDcard, use the ",(0,a.yg)("inlineCode",{parentName:"li"},"removeDir()")," function and pass as an argument the SD filesystem and the directory name path.")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-c"},'removeDir(SD, "/mydir");\n')),(0,a.yg)("ol",{start:7},(0,a.yg)("li",{parentName:"ol"},"The ",(0,a.yg)("inlineCode",{parentName:"li"},"readFile()")," function reads the content of a file and prints the content in the Serial Monitor. As with previous functions, pass as an argument the ",(0,a.yg)("inlineCode",{parentName:"li"},"SD")," filesystem and the file path. For example, the following line reads the content of the ",(0,a.yg)("inlineCode",{parentName:"li"},"hello.txt")," file.")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-c"},'readFile(SD, "/hello.txt")\n')),(0,a.yg)("ol",{start:8},(0,a.yg)("li",{parentName:"ol"},"To write content to a file, you can use the ",(0,a.yg)("inlineCode",{parentName:"li"},"writeFile()")," function. Pass as an argument, the ",(0,a.yg)("inlineCode",{parentName:"li"},"SD")," filesystem, the file path and the message. The following line writes ",(0,a.yg)("inlineCode",{parentName:"li"},"Hello")," in the ",(0,a.yg)("inlineCode",{parentName:"li"},"hello.txt")," file.")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-c"},'writeFile(SD, "/hello.txt", "Hello ");\n')),(0,a.yg)("ol",{start:9},(0,a.yg)("li",{parentName:"ol"},"Similarly, you can append content to a file (without overwriting previous content) using the ",(0,a.yg)("inlineCode",{parentName:"li"},"appendFile()")," function. The following line appends the message ",(0,a.yg)("inlineCode",{parentName:"li"},"World!\\n")," in the ",(0,a.yg)("inlineCode",{parentName:"li"},"hello.txt")," file. The ",(0,a.yg)("inlineCode",{parentName:"li"},"\\n")," means that the next time you write something to the file, it will be written in a new line.")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-c"},'appendFile(SD, "/hello.txt", "World!\\n");\n')),(0,a.yg)("ol",{start:10},(0,a.yg)("li",{parentName:"ol"},"You can rename a file using the ",(0,a.yg)("inlineCode",{parentName:"li"},"renameFile()")," function. Pass as arguments the SD filesystem, the original filename, and the new filename. The following line renames the ",(0,a.yg)("inlineCode",{parentName:"li"},"hello.txt")," file to ",(0,a.yg)("inlineCode",{parentName:"li"},"foo.txt"),".")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-c"},'renameFile(SD, "/hello.txt", "/foo.txt");\n')),(0,a.yg)("ol",{start:11},(0,a.yg)("li",{parentName:"ol"},"Use the ",(0,a.yg)("inlineCode",{parentName:"li"},"deleteFile()")," function to delete a file. Pass as an argument the SD filesystem and the file path of the file you want to delete. The following line deletes the ",(0,a.yg)("inlineCode",{parentName:"li"},"foo.txt")," file from the microSDcard.")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-c"},'deleteFile(SD, "/foo.txt");\n')),(0,a.yg)("ol",{start:12},(0,a.yg)("li",{parentName:"ol"},"The ",(0,a.yg)("inlineCode",{parentName:"li"},"testFileIO()")," functions shows how long it takes to read the content of a file. The following function tests the test.txt file.")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-c"},'testFileIO(SD, "/test.txt");\n')),(0,a.yg)("h2",{id:"microsd-card-application-based-on-gas-data-logging"},"MicroSD card application based on gas data logging"),(0,a.yg)("admonition",{type:"caution"},(0,a.yg)("p",{parentName:"admonition"},"This section applies to XIAO ESP32S3 Sense only.")),(0,a.yg)("p",null,"This project shows how to log data with timestamps to a TF card using the XIAO ESP32S3 Sense. As an example, we\u2019ll log temperature readings from the Multichannel Gas Sensor every 10 minutes. The XIAO ESP32S3 will be in deep sleep mode between each reading, and it will request the date and time using Network Time Protocol (NTP)."),(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/SeeedStudio-XIAO-ESP32S3/img/72.jpg",style:{width:800,height:"auto"}})),(0,a.yg)("p",null,"To complete this project, you will need to prepare the following hardware in advance."),(0,a.yg)("table",{align:"center"},(0,a.yg)("tr",null,(0,a.yg)("th",null,"Seeed Studio XIAO ESP32S3 Sense"),(0,a.yg)("th",null,"Seeed Studio Expansion Base for XIAO with Grove OLED"),(0,a.yg)("th",null,"Grove - Multichannel Gas Sensor v2")),(0,a.yg)("tr",null,(0,a.yg)("td",null,(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/SeeedStudio-XIAO-ESP32S3/img/xiaoesp32s3sense.jpg",style:{width:250,height:"auto"}}))),(0,a.yg)("td",null,(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/Seeeduino-XIAO-Expansion-Board/Update_pic/zheng1.jpg",style:{width:250,height:"auto"}}))),(0,a.yg)("td",null,(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/Grove-Multichannel_Gas_Sensor/img/Grove-Multichannel_Gas_Sensor_V2_101020820/IMG/04.png",style:{width:250,height:"auto"}})))),(0,a.yg)("tr",null,(0,a.yg)("td",null,(0,a.yg)("div",{class:"get_one_now_container",style:{textAlign:"center"}},(0,a.yg)("a",{class:"get_one_now_item",href:"https://www.seeedstudio.com/XIAO-ESP32S3-Sense-p-5639.html"},(0,a.yg)("strong",null,(0,a.yg)("span",null,(0,a.yg)("font",{color:"FFFFFF",size:"4"}," Get One Now \ud83d\uddb1\ufe0f")))))),(0,a.yg)("td",null,(0,a.yg)("div",{class:"get_one_now_container",style:{textAlign:"center"}},(0,a.yg)("a",{class:"get_one_now_item",href:"https://www.seeedstudio.com/Seeeduino-XIAO-Expansion-board-p-4746.html"},(0,a.yg)("strong",null,(0,a.yg)("span",null,(0,a.yg)("font",{color:"FFFFFF",size:"4"}," Get One Now \ud83d\uddb1\ufe0f")))))),(0,a.yg)("td",null,(0,a.yg)("div",{class:"get_one_now_container",style:{textAlign:"center"}},(0,a.yg)("a",{class:"get_one_now_item",href:"https://www.seeedstudio.com/Grove-Multichannel-Gas-Sensor-v2-p-4569.html"},(0,a.yg)("strong",null,(0,a.yg)("span",null,(0,a.yg)("font",{color:"FFFFFF",size:"4"}," Get One Now \ud83d\uddb1\ufe0f")))))))),(0,a.yg)("p",null,"For the software, you need to install the following libraries for the Arduino IDE in advance."),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"NTPClient library forked by Taranais")),(0,a.yg)("div",{class:"github_container",style:{textAlign:"center"}},(0,a.yg)("a",{class:"github_item",href:"https://github.com/taranais/NTPClient"},(0,a.yg)("strong",null,(0,a.yg)("span",null,(0,a.yg)("font",{color:"FFFFFF",size:"4"}," Download the Libraries")))," ",(0,a.yg)("svg",{"aria-hidden":"true",focusable:"false",role:"img",className:"mr-2",viewBox:"-3 10 9 1",width:16,height:16,fill:"currentColor",style:{textAlign:"center",display:"inline-block",userSelect:"none",verticalAlign:"text-bottom",overflow:"visible"}},(0,a.yg)("path",{d:"M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z"})))),(0,a.yg)("br",null),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"Multichannel Gas Sensor library")),(0,a.yg)("div",{class:"github_container",style:{textAlign:"center"}},(0,a.yg)("a",{class:"github_item",href:"https://github.com/Seeed-Studio/Seeed_Arduino_MultiGas"},(0,a.yg)("strong",null,(0,a.yg)("span",null,(0,a.yg)("font",{color:"FFFFFF",size:"4"}," Download the Libraries")))," ",(0,a.yg)("svg",{"aria-hidden":"true",focusable:"false",role:"img",className:"mr-2",viewBox:"-3 10 9 1",width:16,height:16,fill:"currentColor",style:{textAlign:"center",display:"inline-block",userSelect:"none",verticalAlign:"text-bottom",overflow:"visible"}},(0,a.yg)("path",{d:"M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z"})))),(0,a.yg)("br",null),(0,a.yg)("p",null,"Here is the complete sample program. In the program we will need to use the network pairing time, so you need to change the WiFi name and password in the program to yours."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},'#include "FS.h"\n#include "SD.h"\n#include <SPI.h>\n\n//multichannel gas libraries\n#include <Multichannel_Gas_GMXXX.h>\n#include <Wire.h>\n\n// Libraries to get time from NTP Server\n#include <NTPClient.h>\n#include <WiFiUdp.h>\n\n#include "WiFi.h"\n\n// Define deep sleep options\nuint64_t uS_TO_S_FACTOR = 1000000;  // Conversion factor for micro seconds to seconds\n// Sleep for 10 minutes = 600 seconds\nuint64_t TIME_TO_SLEEP = 600;\n\n// Replace with your network credentials\nconst char* ssid     = "REPLACE_WITH_YOUR_SSID";\nconst char* password = "REPLACE_WITH_YOUR_PASSWORD";\n\n// Define CS pin for the SD card module\n#define SD_CS 21\n\n// Save reading number on RTC memory\nRTC_DATA_ATTR int readingID = 0;\n\nString dataMessage;\n\n// Gas Sensor variables\nint NO2_val, C2H5CH_val, VOC_val, CO_val;\nGAS_GMXXX<TwoWire> gas;\n\n// Define NTP Client to get time\nWiFiUDP ntpUDP;\nNTPClient timeClient(ntpUDP);\n\n// Variables to save date and time\nString formattedDate;\nString dayStamp;\nString timeStamp;\n\nvoid setup() {\n  // Start serial communication for debugging purposes\n  Serial.begin(115200);\n\n  // Connect to Wi-Fi network with SSID and password\n  Serial.print("Connecting to ");\n  Serial.println(ssid);\n  WiFi.begin(ssid, password);\n  while (WiFi.status() != WL_CONNECTED) {\n    delay(500);\n    Serial.print(".");\n  }\n  Serial.println("");\n  Serial.println("WiFi connected.");\n\n  // Initialize a NTPClient to get time\n  timeClient.begin();\n  // Set offset time in seconds to adjust for your timezone, for example:\n  // GMT +1 = 3600\n  // GMT +8 = 28800\n  // GMT -1 = -3600\n  // GMT 0 = 0\n  timeClient.setTimeOffset(3600);\n\n  // Initialize SD card\n  SD.begin(SD_CS);  \n  if(!SD.begin(SD_CS)) {\n    Serial.println("Card Mount Failed");\n    return;\n  }\n  uint8_t cardType = SD.cardType();\n  if(cardType == CARD_NONE) {\n    Serial.println("No SD card attached");\n    return;\n  }\n  Serial.println("Initializing SD card...");\n  if (!SD.begin(SD_CS)) {\n    Serial.println("ERROR - SD card initialization failed!");\n    return;    // init failed\n  }\n\n  // If the data.txt file doesn\'t exist\n  // Create a file on the SD card and write the data labels\n  File file = SD.open("/data.txt");\n  if(!file) {\n    Serial.println("File doens\'t exist");\n    Serial.println("Creating file...");\n    writeFile(SD, "/data.txt", "Reading ID, Date, Hour, NO2, C2H5CH, VOC, CO \\r\\n");\n  }\n  else {\n    Serial.println("File already exists");  \n  }\n  file.close();\n\n  // Start the gas sensor\n  gas.begin(Wire, 0x08); // use the hardware I2C\n\n  getReadings();\n  getTimeStamp();\n  logSDCard();\n  \n  // Increment readingID on every new reading\n  readingID++;\n  \n  // Start deep sleep\n  Serial.println("DONE! Going to sleep now.");\n\n  // Enable Timer wake_up\n  esp_sleep_enable_timer_wakeup(TIME_TO_SLEEP * uS_TO_S_FACTOR);\n  esp_deep_sleep_start(); \n}\n\nvoid loop() {\n  // The ESP32 will be in deep sleep\n  // it never reaches the loop()\n}\n\n// Function to get temperature\nvoid getReadings(){\n  // GM102B NO2 sensor ppm\n  NO2_val = gas.getGM102B();\n  // GM302B C2H5CH sensor ppm\n  C2H5CH_val = gas.getGM302B();\n  // GM502B VOC sensor\n  VOC_val = gas.getGM502B();\n  // GM702B CO sensor\n  CO_val = gas.getGM702B();\n  \n  Serial.print("NO2 Value is: ");\n  Serial.println(NO2_val);\n  \n  Serial.print("C2H5CH Value is: ");\n  Serial.println(C2H5CH_val);\n  \n  Serial.print("VOC Value is: ");\n  Serial.println(VOC_val);\n\n  Serial.print("CO Value is: ");\n  Serial.println(CO_val);\n}\n\n// Function to get date and time from NTPClient\nvoid getTimeStamp() {\n  while(!timeClient.update()) {\n    timeClient.forceUpdate();\n  }\n  // The formattedDate comes with the following format:\n  // 2018-05-28T16:00:13Z\n  // We need to extract date and time\n  formattedDate = timeClient.getFormattedDate();\n  Serial.println(formattedDate);\n\n  // Extract date\n  int splitT = formattedDate.indexOf("T");\n  dayStamp = formattedDate.substring(0, splitT);\n  Serial.println(dayStamp);\n  // Extract time\n  timeStamp = formattedDate.substring(splitT+1, formattedDate.length()-1);\n  Serial.println(timeStamp);\n}\n\n// Write the sensor readings on the SD card\nvoid logSDCard() {\n  dataMessage = String(readingID) + "," + String(dayStamp) + "," + String(timeStamp) + "," + \n                String(NO2_val) + "," + String(C2H5CH_val) + "," + String(VOC_val) + "," + \n                String(CO_val) + "\\r\\n";\n  Serial.print("Save data: ");\n  Serial.println(dataMessage);\n  appendFile(SD, "/data.txt", dataMessage.c_str());\n}\n\n// Write to the SD card (DON\'T MODIFY THIS FUNCTION)\nvoid writeFile(fs::FS &fs, const char * path, const char * message) {\n  Serial.printf("Writing file: %s\\n", path);\n\n  File file = fs.open(path, FILE_WRITE);\n  if(!file) {\n    Serial.println("Failed to open file for writing");\n    return;\n  }\n  if(file.print(message)) {\n    Serial.println("File written");\n  } else {\n    Serial.println("Write failed");\n  }\n  file.close();\n}\n\n// Append data to the SD card (DON\'T MODIFY THIS FUNCTION)\nvoid appendFile(fs::FS &fs, const char * path, const char * message) {\n  Serial.printf("Appending to file: %s\\n", path);\n\n  File file = fs.open(path, FILE_APPEND);\n  if(!file) {\n    Serial.println("Failed to open file for appending");\n    return;\n  }\n  if(file.print(message)) {\n    Serial.println("Message appended");\n  } else {\n    Serial.println("Append failed");\n  }\n  file.close();\n}\n')),(0,a.yg)("p",null,"Compile and upload the program, and open the serial port monitor. If the program runs smoothly, you will see the following message output from the serial monitor."),(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/SeeedStudio-XIAO-ESP32S3/img/70.png",style:{width:700,height:"auto"}})),(0,a.yg)("p",null,"You can always remove the microSD card at your convenience and access the saved sensor data via the card reader."),(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/SeeedStudio-XIAO-ESP32S3/img/71.png",style:{width:500,height:"auto"}})),(0,a.yg)("admonition",{type:"note"},(0,a.yg)("p",{parentName:"admonition"},"In order to facilitate testing, the effect is shown every minute to save data, the actual sample code provided is ten minutes to save data once.")),(0,a.yg)("admonition",{type:"caution"},(0,a.yg)("p",{parentName:"admonition"},"There are the following things to note about this project:"),(0,a.yg)("ol",{parentName:"admonition"},(0,a.yg)("li",{parentName:"ol"},"The Multichannel Gas Sensor needs a period of warm-up before the values obtained are accurate. So the first few sets of data recorded can be considered to be discarded if the error is large."),(0,a.yg)("li",{parentName:"ol"},"The serial monitor will only output the saved information once, because this example uses the deep sleep function, it is equivalent to reset after waking up, that is, you need to reopen the serial port of Arduino to see the next debug information. But rest assured, if there is no problem with the card, the sensor data will be collected on time at the time you set."))),(0,a.yg)("h3",{id:"program-annotation-1"},"Program annotation"),(0,a.yg)("p",null,"In this example, the XIAO ESP32S3 is in deep sleep mode between each reading. In deep sleep mode, all your code should go in the ",(0,a.yg)("inlineCode",{parentName:"p"},"setup()")," function, because the XIAO ESP32S3 never reaches the ",(0,a.yg)("inlineCode",{parentName:"p"},"loop()"),"."),(0,a.yg)("p",null,"This example uses a conversion factor from microseconds to seconds, so that you can set the sleep time in the ",(0,a.yg)("inlineCode",{parentName:"p"},"TIME_TO_SLEEP")," variable in seconds. In this case, we\u2019re setting the XIAO ESP32S3 to go to sleep for 10 minutes (600 seconds). If you want the XIAO ESP32S3 to sleep for a different period of time, you just need to enter the number of seconds for deep sleep in the ",(0,a.yg)("inlineCode",{parentName:"p"},"TIME_TO_SLEEP")," variable."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-c"},"// Define deep sleep options\nuint64_t uS_TO_S_FACTOR = 1000000; // Conversion factor for micro seconds to seconds\n// Sleep for 10 minutes = 600 seconds\nuint64_t TIME_TO_SLEEP = 600;\n")),(0,a.yg)("p",null,"Next, define the microSD card CS pin. In this case, it is set to ",(0,a.yg)("strong",{parentName:"p"},"GPIO 21"),"."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-c"},"#define SD_CS 21\n")),(0,a.yg)("p",null,"Create a variable called ",(0,a.yg)("inlineCode",{parentName:"p"},"readingID")," to hold the reading ID. This is a way to get your readings organized. To save a variable value during deep sleep, we can save it in the RTC memory. To save data on the RTC memory, you just need to add ",(0,a.yg)("inlineCode",{parentName:"p"},"RTC_DATA_ATTR")," before the variable definition."),(0,a.yg)("p",null,"Create a String variable to hold the data to be saved on the microSD card."),(0,a.yg)("p",null,"The following two lines define an NTPClient to request date and time from an NTP server."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-c"},"WiFiUDP ntpUDP;\nNTPClient timeClient(ntpUDP);\n")),(0,a.yg)("p",null,"Next, initialize the NTP client in the ",(0,a.yg)("inlineCode",{parentName:"p"},"Setup()")," function to get the date and time from the NTP server. You can use the ",(0,a.yg)("inlineCode",{parentName:"p"},"setTimeOffset(<time>)")," method to adjust the time for your timezone."),(0,a.yg)("p",null,"After having everything initialized, we can get the readings, timestamp, and log everything into the microSD card."),(0,a.yg)("p",null,"To make the code easier to understand, we\u2019ve created the following functions:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"getReadings()"),": reads the gas value from the Multichannel Gas Sensor;"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"getTimeStamp()"),": gets date and time from the NTP server;"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"logSDcard()"),": logs the preceding data to the microSD card.")),(0,a.yg)("p",null,"Finally, the ESP32 starts the deep sleep."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-c"},"esp_sleep_enable_timer_wakeup(TIME_TO_SLEEP * uS_TO_S_FACTOR);\nesp_deep_sleep_start(); \n")),(0,a.yg)("p",null,"We recommend that you use these two functions together. Make sure that XIAO can enter deep sleep mode as soon as possible after setting the wake-up time."),(0,a.yg)("h2",{id:"serial-peripheral-interface-flash-file-system-spiffs"},"Serial Peripheral Interface Flash File System (SPIFFS)"),(0,a.yg)("admonition",{type:"caution"},(0,a.yg)("p",{parentName:"admonition"},"This section applies to the XIAO ESP32C3, XIAO ESP32S3, or XIAO ESP32S3 Sense, but this section does not support Arduino IDE 2.X.")),(0,a.yg)("p",null,"The ESP32 contains a Serial Peripheral Interface Flash File System (SPIFFS). SPIFFS is a lightweight filesystem created for microcontrollers with a flash chip, which is connected by SPI bus, like the ESP32 flash memory. In this article we\u2019re going to show how to easily upload files to the ESP32 filesystem using a plugin for Arduino IDE."),(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/SeeedStudio-XIAO-ESP32S3/img/73.jpg",style:{width:1e3,height:"auto"}})),(0,a.yg)("p",null,"SPIFFS lets you access the flash memory like you would do in a normal filesystem in your computer, but simpler and more limited. You can read, write, close, and delete files. At the time of writing this post, SPIFFS doesn\u2019t support directories, so everything is saved on a flat structure."),(0,a.yg)("p",null,"Using SPIFFS with the XIAO ESP32 is especially useful to:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"Create configuration files with settings"),(0,a.yg)("li",{parentName:"ul"},"Save data permanently"),(0,a.yg)("li",{parentName:"ul"},"Create files to save small amounts of data instead of using a microSD card"),(0,a.yg)("li",{parentName:"ul"},"Save HTML and CSS files to build a web server"),(0,a.yg)("li",{parentName:"ul"},"Save images, figures, and icons")),(0,a.yg)("h3",{id:"installing-the-arduino-esp32-filesystem-uploader"},"Installing the Arduino ESP32 Filesystem Uploader"),(0,a.yg)("p",null,"You can create, save and write files to the ESP32 filesystem by writing the code yourself on the Arduino IDE. This is not very useful, because you\u2019d have to type the content of your files in the Arduino sketch."),(0,a.yg)("p",null,"Fortunately, there is a plugin for the Arduino IDE that allows you to upload files directly to the ESP32 filesystem from a folder on your computer. This makes it really easy and simple to work with files. Let\u2019s install it."),(0,a.yg)("admonition",{type:"note"},(0,a.yg)("p",{parentName:"admonition"},"Note: at the time of writing this post, the ESP32 Filesystem Uploader plugin ",(0,a.yg)("strong",{parentName:"p"},"is not supported on Arduino 2.0"),".")),(0,a.yg)("h4",{id:"windows"},"Windows"),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Step 1.")," Go to the ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/me-no-dev/arduino-esp32fs-plugin/releases/"},"releases page")," and click the ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/me-no-dev/arduino-esp32fs-plugin/releases/download/1.1/ESP32FS-1.1.zip"},"ESP32FS-1.1.zip")," file to download."),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Step 2.")," Find your Sketchbook location. In your Arduino IDE, go to ",(0,a.yg)("strong",{parentName:"p"},"File > Preferences")," and check your Sketchbook location. In my case, it\u2019s in the following path: ",(0,a.yg)("inlineCode",{parentName:"p"},"C:\\Users\\mengd\\Documents\\Arduino"),"."),(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/SeeedStudio-XIAO-ESP32S3/img/73.png",style:{width:700,height:"auto"}})),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Step 3.")," Go to the sketchbook location, and create a ",(0,a.yg)("strong",{parentName:"p"},"tools")," folder."),(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/SeeedStudio-XIAO-ESP32S3/img/74.png",style:{width:400,height:"auto"}})),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Step 4.")," Unzip the downloaded ",(0,a.yg)("em",{parentName:"p"},".zip")," folder. Open it and copy the ESP32FS folder to the tools folder you created in the previous step. You should have a similar folder structure:"),(0,a.yg)("p",null,(0,a.yg)("inlineCode",{parentName:"p"},"<Sketchbook-location>/tools/ESP32FS/tool/esp32fs.jar")),(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/SeeedStudio-XIAO-ESP32S3/img/75.png",style:{width:500,height:"auto"}})),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Step 5.")," Finally, restart your Arduino IDE."),(0,a.yg)("p",null,"To check if the plugin was successfully installed, open your Arduino IDE. Select ",(0,a.yg)("strong",{parentName:"p"},"XIAO ESP32S3")," or ",(0,a.yg)("strong",{parentName:"p"},"XIAO ESP32C3"),", go to ",(0,a.yg)("strong",{parentName:"p"},"Tools")," and check that you have the option ",(0,a.yg)("strong",{parentName:"p"},"ESP32 Sketch Data Upload"),"."),(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/SeeedStudio-XIAO-ESP32S3/img/76.png",style:{width:600,height:"auto"}})),(0,a.yg)("h4",{id:"macos"},"MacOS"),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Step 1.")," Go to the ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/me-no-dev/arduino-esp32fs-plugin/releases/"},"releases page")," and click the ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/me-no-dev/arduino-esp32fs-plugin/releases/download/1.1/ESP32FS-1.1.zip"},"ESP32FS-1.1.zip")," file to download."),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Step 2.")," Unpack the files."),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Step 3.")," Create a folder called ",(0,a.yg)("strong",{parentName:"p"},"tools")," in ",(0,a.yg)("inlineCode",{parentName:"p"},"/Documents/Arduino/"),"."),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Step 4.")," Copy the unpacked ",(0,a.yg)("strong",{parentName:"p"},"ESP32FS")," folder to the ",(0,a.yg)("strong",{parentName:"p"},"tools")," directory. You should have a similar folder structure."),(0,a.yg)("p",null,(0,a.yg)("inlineCode",{parentName:"p"},"~Documents/Arduino/tools/ESP32FS/tool/esp32fs.jar")),(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/SeeedStudio-XIAO-ESP32S3/img/77.png",style:{width:500,height:"auto"}})),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Step 5.")," Finally, restart your Arduino IDE."),(0,a.yg)("p",null,"To check if the plugin was successfully installed, open your Arduino IDE. Select ",(0,a.yg)("strong",{parentName:"p"},"XIAO ESP32S3")," or ",(0,a.yg)("strong",{parentName:"p"},"XIAO ESP32C3"),", go to ",(0,a.yg)("strong",{parentName:"p"},"Tools")," and check that you have the option ",(0,a.yg)("strong",{parentName:"p"},"ESP32 Sketch Data Upload"),"."),(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/SeeedStudio-XIAO-ESP32S3/img/78.png",style:{width:600,height:"auto"}})),(0,a.yg)("h3",{id:"uploading-files-using-the-filesystem-uploader"},"Uploading Files using the Filesystem Uploader"),(0,a.yg)("p",null,"To upload files to the ESP32 filesystem follow the next instructions."),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Step 6.")," Create an Arduino sketch and save it. For demonstration purposes, you can save an empty sketch."),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Step 7.")," Then, open the sketch folder. You can go to ",(0,a.yg)("strong",{parentName:"p"},"Sketch > Show Sketch Folder"),". The folder where your sketch is saved should open."),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Step 8.")," Inside that folder, create a new folder called ",(0,a.yg)("strong",{parentName:"p"},"data"),"."),(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/SeeedStudio-XIAO-ESP32S3/img/79.png",style:{width:400,height:"auto"}})),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Step 9.")," Inside the data folder is where you should put the files you want to save into the ESP32 filesystem. As an example, create a ",(0,a.yg)("em",{parentName:"p"},".txt")," file with some text called ",(0,a.yg)("strong",{parentName:"p"},"test_example"),"."),(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/SeeedStudio-XIAO-ESP32S3/img/80.png",style:{width:700,height:"auto"}})),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Step 10.")," Then, to upload the files, in the Arduino IDE, you just need to go to ",(0,a.yg)("strong",{parentName:"p"},"Tools > ESP32 Sketch Data Upload"),"."),(0,a.yg)("admonition",{type:"caution"},(0,a.yg)("p",{parentName:"admonition"},"The uploader will overwrite anything you had already saved in the filesystem.")),(0,a.yg)("p",null,"The files were successfully uploaded to the ESP32 filesystem when you see the message ",(0,a.yg)("strong",{parentName:"p"},"SPIFFS Image Uploaded"),"."),(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/SeeedStudio-XIAO-ESP32S3/img/81.png",style:{width:800,height:"auto"}})),(0,a.yg)("h3",{id:"testing-the-uploader"},"Testing the Uploader"),(0,a.yg)("p",null,"Now, let\u2019s just check if the file was actually saved into the ESP32 filesystem. Simply upload the following code to your ESP32 board."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-cpp"},'#include "SPIFFS.h"\n \nvoid setup() {\n  Serial.begin(115200);\n  while(!Serial);\n  \n  if(!SPIFFS.begin(true)){\n    Serial.println("An Error has occurred while mounting SPIFFS");\n    return;\n  }\n\n  File file = SPIFFS.open("/test_example.txt");\n  if(!file){\n    Serial.println("Failed to open file for reading");\n    return;\n  }\n  \n  Serial.println("File Content:");\n  while(file.available()){\n    Serial.write(file.read());\n  }\n  file.close();\n  \n}\n \nvoid loop() {\n  \n}\n')),(0,a.yg)("p",null,"After uploading, open the Serial Monitor at a baud rate of 115200. It should print the content of your ",(0,a.yg)("em",{parentName:"p"},".txt")," file on the Serial Monitor."),(0,a.yg)("div",{style:{textAlign:"center"}},(0,a.yg)("img",{src:"https://files.seeedstudio.com/wiki/SeeedStudio-XIAO-ESP32S3/img/82.png",style:{width:800,height:"auto"}})),(0,a.yg)("h2",{id:"flash-data-storage"},"Flash Data Storage"),(0,a.yg)("admonition",{type:"caution"},(0,a.yg)("p",{parentName:"admonition"},"This section applies to the XIAO ESP32C3, XIAO ESP32S3, or XIAO ESP32S3 Sense.")),(0,a.yg)("p",null,"When we use development boards, many of us will want to be able to use the flash memory on the chip to store some important data. This requires a storage method that ensures that no data is lost even in the event of an abnormal development board."),(0,a.yg)("p",null,"This tutorial will introduce how to store important data on the XIAO ESP32 flash memory from two different storage methods as follows:"),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("p",{parentName:"li"},"First guide shows how to save data permanently on the ESP32 flash memory using the Preferences.h library. The data held in the flash memory persists across resets or power failures. Using the Preferences.h library is useful to save data like network credentials, API keys, threshold values, or even the last state of a GPIO. You\u2019ll learn how to save and read data from flash memory.")),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("p",{parentName:"li"},"Second guid explains what is the XIAO ESP32C3 EEPROM and what it is useful for. We\u2019re also going to show you how to write and read from the EEPROM and build a project example to put the concepts learned into practice."))),(0,a.yg)("p",null,"This section has been written for the XIAO ESP32C3 and is fully compatible with the new XIAO ESP32S3, so you can use the routines here directly, so we won't go over it again here."),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"https://wiki.seeedstudio.com/xiaoesp32c3-flash-storage/"},"XIAO ESP32C3 Data Permanently in different ways"))),(0,a.yg)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,a.yg)("h2",{id:"citations--references"},"Citations & References"),(0,a.yg)("p",null,"This article draws on the files system content ",(0,a.yg)("strong",{parentName:"p"},(0,a.yg)("a",{parentName:"strong",href:"https://randomnerdtutorials.com/"},"Random Nerd Tutorials")),"' on ESP32 and uses it verified on the Seeed Studio XIAO ESP32S3 Sense. "),(0,a.yg)("p",null,"Special thanks to the authors of ",(0,a.yg)("strong",{parentName:"p"},"Random Nerd Tutorials")," for their hard work!"),(0,a.yg)("p",null,"The following is the reference link to the original article, you are welcome to learn more about ESP32 files system through the following link to the original article."),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"https://randomnerdtutorials.com/esp32-microsd-card-arduino/"},"ESP32: Guide for MicroSD Card Module using Arduino IDE")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"https://randomnerdtutorials.com/esp32-data-logging-temperature-to-microsd-card/"},"ESP32 Data Logging Temperature to MicroSD Card")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"https://randomnerdtutorials.com/install-esp32-filesystem-uploader-arduino-ide/"},"Install ESP32 Filesystem Uploader in Arduino IDE"))),(0,a.yg)("p",null,"For more information about using the ESP32 development board, please read the official website of Random Nerd Tutorials."),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"https://randomnerdtutorials.com/"},"Random Nerd Tutorials"))),(0,a.yg)("h2",{id:"tech-support--product-discussion"},"Tech Support & Product Discussion"),(0,a.yg)("p",null,"."),(0,a.yg)("p",null,"Thank you for choosing our products! We are here to provide you with different support to ensure that your experience with our products is as smooth as possible. We offer several communication channels to cater to different preferences and needs."),(0,a.yg)("div",{class:"button_tech_support_container"},(0,a.yg)("a",{href:"https://forum.seeedstudio.com/",class:"button_forum"}),(0,a.yg)("a",{href:"https://www.seeedstudio.com/contacts",class:"button_email"})),(0,a.yg)("div",{class:"button_tech_support_container"},(0,a.yg)("a",{href:"https://discord.gg/eWkprNDMU7",class:"button_discord"}),(0,a.yg)("a",{href:"https://github.com/Seeed-Studio/wiki-documents/discussions/69",class:"button_discussion"})))}c.isMDXComponent=!0}}]);