"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[40887],{15680:(e,n,t)=>{t.d(n,{xA:()=>u,yg:()=>m});var i=t(96540);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,i,r=function(e,n){if(null==e)return{};var t,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=i.createContext({}),p=function(e){var n=i.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},u=function(e){var n=p(e.components);return i.createElement(l.Provider,{value:n},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},g=i.forwardRef((function(e,n){var t=e.components,r=e.mdxType,a=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=p(t),g=r,m=d["".concat(l,".").concat(g)]||d[g]||c[g]||a;return t?i.createElement(m,o(o({ref:n},u),{},{components:t})):i.createElement(m,o({ref:n},u))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var a=t.length,o=new Array(a);o[0]=g;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[d]="string"==typeof e?e:r,o[1]=s;for(var p=2;p<a;p++)o[p]=t[p];return i.createElement.apply(null,o)}return i.createElement.apply(null,t)}g.displayName="MDXCreateElement"},17042:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>a,metadata:()=>s,toc:()=>p});var i=t(58168),r=(t(96540),t(15680));const a={title:"Grove - Wio-E5 Helium and TinyML Application Demo",nointro:null,keywords:["docs","docusaurus"],image:"https://files.seeedstudio.com/wiki/wiki-platform/S-tempor.png",slug:"/Grove_Wio_E5_Helium_tinyML_Demo",last_update:{date:"09/19/2023",author:"Salman"}},o=void 0,s={unversionedId:"Sensor/Grove/Grove_Sensors_Network/LoRa/demo/Grove_Wio_E5_Helium_tinyML_Demo",id:"Sensor/Grove/Grove_Sensors_Network/LoRa/demo/Grove_Wio_E5_Helium_tinyML_Demo",title:"Grove - Wio-E5 Helium and TinyML Application Demo",description:"Getting Started",source:"@site/docs/Sensor/Grove/Grove_Sensors_Network/LoRa/demo/Grove_Wio_E5_Helium_tinyML_Demo.md",sourceDirName:"Sensor/Grove/Grove_Sensors_Network/LoRa/demo",slug:"/Grove_Wio_E5_Helium_tinyML_Demo",permalink:"/Grove_Wio_E5_Helium_tinyML_Demo",draft:!1,editUrl:"https://github.com/Seeed-Studio/wiki-documents/blob/docusaurus-version/docs/Sensor/Grove/Grove_Sensors_Network/LoRa/demo/Grove_Wio_E5_Helium_tinyML_Demo.md",tags:[],version:"current",lastUpdatedBy:"Salman",lastUpdatedAt:1695081600,formattedLastUpdatedAt:"Sep 19, 2023",frontMatter:{title:"Grove - Wio-E5 Helium and TinyML Application Demo",nointro:null,keywords:["docs","docusaurus"],image:"https://files.seeedstudio.com/wiki/wiki-platform/S-tempor.png",slug:"/Grove_Wio_E5_Helium_tinyML_Demo",last_update:{date:"09/19/2023",author:"Salman"}},sidebar:"ProductSidebar",previous:{title:"Grove - Wio-E5 Helium Demo",permalink:"/Grove_Wio_E5_Helium_Demo"},next:{title:"Grove - Wio-E5 Used with Arduino Uno R4 Demo",permalink:"/Grove_Wio_E5_SenseCAP_Cloud_Demo"}},l={},p=[{value:"Getting Started",id:"getting-started",level:2},{value:"Flowchart",id:"flowchart",level:2},{value:"Hardware Required",id:"hardware-required",level:3},{value:"Software Tools/Service Required",id:"software-toolsservice-required",level:3},{value:"Setup XIAO nRF52840 Sense on Arduino IDE",id:"setup-xiao-nrf52840-sense-on-arduino-ide",level:2},{value:"Software setup",id:"software-setup",level:3},{value:"Setup Helium LoRa WAN Console.",id:"setup-helium-lora-wan-console",level:2},{value:"Helium IoT Console Prepration",id:"helium-iot-console-prepration",level:3},{value:"Hardware Preparation.",id:"hardware-preparation",level:2},{value:"Software Preparation.",id:"software-preparation",level:2},{value:"Demo",id:"demo",level:2},{value:"ToDo",id:"todo",level:2},{value:"Resources",id:"resources",level:2},{value:"Tech Support &amp; Product Discussion",id:"tech-support--product-discussion",level:2}],u={toc:p},d="wrapper";function c(e){let{components:n,...t}=e;return(0,r.yg)(d,(0,i.A)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,r.yg)("h2",{id:"getting-started"},"Getting Started"),(0,r.yg)("p",null,"Here, we are going build a project that utilize tinyML and helium LoRa IoT network to prevent illegal wood logging. "),(0,r.yg)("p",{style:{textAlign:"center"}},(0,r.yg)("img",{src:"https://raw.githubusercontent.com/salmanfarisvp/resource/main/Images/lora%2Btinyml/illegalWoodlogging.png\n",alt:"pir",width:1e3,height:"auto"})),(0,r.yg)("h2",{id:"flowchart"},"Flowchart"),(0,r.yg)("p",{style:{textAlign:"center"}},(0,r.yg)("img",{src:"https://raw.githubusercontent.com/salmanfarisvp/resource/main/Images/lora%2Btinyml/ForestKeeperAlgoritham.png",alt:"pir",width:1e3,height:"auto"})),(0,r.yg)("h3",{id:"hardware-required"},"Hardware Required"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Seeeduino XIAO nRF52840 Sense"),(0,r.yg)("th",{parentName:"tr",align:null},"Grove - Wio-E5"),(0,r.yg)("th",{parentName:"tr",align:null},"Seeeduino XIAO Expansion Board"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("p",{style:{textAlign:"center"}},(0,r.yg)("img",{src:"https://files.seeedstudio.com/wiki/XIAO-BLE/102010469_Front-14.jpg",alt:"pir",width:600,height:"auto"}))),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("p",{style:{textAlign:"center"}},(0,r.yg)("img",{src:"https://media-cdn.seeedstudio.com/media/catalog/product/cache/9d0ce51a71ce6a79dfa2a98d65a0f0bd/1/1/11302009_preview-34.png",alt:"pir",width:600,height:"auto"}))),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("p",{style:{textAlign:"center"}},(0,r.yg)("img",{src:"https://files.seeedstudio.com/wiki/Seeeduino-XIAO-Expansion-Board/Update_pic/zheng1.jpg",alt:"pir",width:600,height:"auto"})))))),(0,r.yg)("h3",{id:"software-toolsservice-required"},"Software Tools/Service Required"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},"1x Ardunino IDE"),(0,r.yg)("li",{parentName:"ol"},"1x ",(0,r.yg)("a",{parentName:"li",href:"https://console.helium.com/"},"Helium IoT Console")," . "),(0,r.yg)("li",{parentName:"ol"},"1 x Computer"),(0,r.yg)("li",{parentName:"ol"},"1 x USB Type-C cable")),(0,r.yg)("h2",{id:"setup-xiao-nrf52840-sense-on-arduino-ide"},"Setup XIAO nRF52840 Sense on Arduino IDE"),(0,r.yg)("p",{style:{textAlign:"center"}},(0,r.yg)("img",{src:"https://files.seeedstudio.com/wiki/XIAO-BLE/front-pinout-4.jpg",alt:"pir",width:700,height:"auto"})),(0,r.yg)("p",{style:{textAlign:"center"}},(0,r.yg)("img",{src:"https:///files.seeedstudio.com/wiki/XIAO-BLE/pinout2.png",alt:"pir",width:800,height:"auto"})),(0,r.yg)("p",{style:{textAlign:"center"}},(0,r.yg)("img",{src:"https:///files.seeedstudio.com/wiki/XIAO-BLE/back-pinout-5.jpg",alt:"pir",width:700,height:"auto"})),(0,r.yg)("admonition",{type:"tip"},(0,r.yg)("p",{parentName:"admonition"},"Some USB cables can only supply power and cannot transfer data. If you don't have a USB cable or don't know if your USB cable can transmit data, you can check ",(0,r.yg)("a",{parentName:"p",href:"https://www.seeedstudio.com/USB-3-1-Type-C-to-A-Cable-1-Meter-3-1A-p-4085.html"},"Seeed USB Type-C support USB 3.1"),".")),(0,r.yg)("p",null,"Connect the Seeed Studio XIAO nRF52840 (Sense) to your computer via a USB Type-C cable."),(0,r.yg)("p",{style:{textAlign:"center"}},(0,r.yg)("img",{src:"https://files.seeedstudio.com/wiki/XIAO-BLE/bletpyecconnect.png",alt:"pir",width:500,height:"auto"})),(0,r.yg)("h3",{id:"software-setup"},"Software setup"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},"Step 1.")," Download and Install the latest version of Arduino IDE according to your operating system")),(0,r.yg)("p",{style:{textAlign:"center"}},(0,r.yg)("a",{href:"https://www.arduino.cc/en/software"},(0,r.yg)("img",{src:"https://files.seeedstudio.com/wiki/Seeeduino_Stalker_V3_1/images/Download_IDE.png",alt:"pir",width:700,height:"auto"}))),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"Step 2.")," Launch the Arduino application")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"Step 3.")," Add Seeed Studio XIAO nRF52840 (Sense) board package to your Arduino IDE"))),(0,r.yg)("p",null,"Navigate to ",(0,r.yg)("strong",{parentName:"p"},"File > Preferences"),", and fill ",(0,r.yg)("strong",{parentName:"p"},'"Additional Boards Manager URLs"')," with the url below:\n",(0,r.yg)("em",{parentName:"p"},(0,r.yg)("a",{parentName:"em",href:"https://files.seeedstudio.com/arduino/package_seeeduino_boards_index.json"},"https://files.seeedstudio.com/arduino/package_seeeduino_boards_index.json"))),(0,r.yg)("p",{style:{textAlign:"center"}},(0,r.yg)("img",{src:"https://files.seeedstudio.com/wiki/Wio-Terminal/img/Boardurl.png",alt:"pir",width:700,height:"auto"})),(0,r.yg)("p",null,"Navigate to ",(0,r.yg)("strong",{parentName:"p"},"Tools > Board > Boards Manager..."),', type the keyword "',(0,r.yg)("strong",{parentName:"p"},"seeed nrf52"),'" in the search box, select the latest version of the board you want, and install it. You can install both.'),(0,r.yg)("p",{style:{textAlign:"center"}},(0,r.yg)("img",{src:"https://files.seeedstudio.com/wiki/XIAO-BLE/XIAO_nrf528401.png",alt:"pir",width:700,height:"auto"})),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},"Step 4.")," Select your board and port")),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Board")),(0,r.yg)("p",null,"After installing the board package, navigate to ",(0,r.yg)("strong",{parentName:"p"},"Tools > Board"),' and choose the board you want, continue to select "',(0,r.yg)("strong",{parentName:"p"},"Seeed XIAO BLE Sense nRF52840"),'" from "Seeed nRF mbed-enabled Boards". Now we have finished setting up the Seeed Studio XIAO nRF52840 (Sense) for Arduino IDE.'),(0,r.yg)("p",{style:{textAlign:"center"}},(0,r.yg)("img",{src:"https://raw.githubusercontent.com/salmanfarisvp/TinyML/main/XIAO-nRF52840-Sense/src/img/sense_mebed_board.png",alt:"pir",width:700,height:"auto"})),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Port")),(0,r.yg)("p",null,"Navigate to ",(0,r.yg)("strong",{parentName:"p"},"Tools > Port")," and select the serial port name of the connected Seeed Studio XIAO nRF52840 (Sense). This is likely to be COM3 or higher (",(0,r.yg)("strong",{parentName:"p"},"COM1")," and ",(0,r.yg)("strong",{parentName:"p"},"COM2")," are usually reserved for hardware serial ports). The serial port of the connected Seeed Studio XIAO nRF52840 (Sense) usually contains parentheses that are written ",(0,r.yg)("strong",{parentName:"p"},"Seeed Studio XIAO nRF52840")," for ",(0,r.yg)("strong",{parentName:"p"},"Seeed Studio XIAO nRF52840")," or ",(0,r.yg)("strong",{parentName:"p"},"Seeed Studio XIAO nRF52840 Sense")," for ",(0,r.yg)("strong",{parentName:"p"},"Seeed Studio XIAO nRF52840 Sense"),"."),(0,r.yg)("p",{style:{textAlign:"center"}},(0,r.yg)("img",{src:"https://files.seeedstudio.com/wiki/XIAO-BLE/port.png",alt:"pir",width:550,height:"auto"})),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},"Step 5.")," Navigate to ",(0,r.yg)("strong",{parentName:"li"},"File > Examples > 01.Basics > Blink")," to open ",(0,r.yg)("strong",{parentName:"li"},"Blink")," example")),(0,r.yg)("p",{style:{textAlign:"center"}},(0,r.yg)("img",{src:"https://files.seeedstudio.com/wiki/Seeeduino_GPRS/img/select_blink.png",alt:"pir",width:550,height:"auto"})),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},"Step 6.")," Click the ",(0,r.yg)("strong",{parentName:"li"},"Upload")," button to upload the Blink example code to the board")),(0,r.yg)("p",{style:{textAlign:"center"}},(0,r.yg)("img",{src:"https://files.seeedstudio.com/wiki/Seeeduino_GPRS/img/upload_image.png",alt:"pir",width:500,height:"auto"})),(0,r.yg)("p",null,"Once uploaded, you will see the built-in red LED blinking with a 1-second delay between each blink. This means the connection is successful and now you can explore more projects with the Seeed Studio XIAO nRF52840 (Sense)!"),(0,r.yg)("h2",{id:"setup-helium-lora-wan-console"},"Setup Helium LoRa WAN Console."),(0,r.yg)("admonition",{type:"note"},(0,r.yg)("p",{parentName:"admonition"},"Make sure you are inside the helium network coverage. You can find the network coverage at ",(0,r.yg)("a",{parentName:"p",href:"https://explorer.helium.com/"},"explorer.helium.com"))),(0,r.yg)("admonition",{title:"attention",type:"caution"},(0,r.yg)("p",{parentName:"admonition"},"Please ensure the consistent of the frequency band among the end nodes, gateway, and Helium configuration you are using by following this instruction.\nThe frequency plan this demo applied is for ",(0,r.yg)("strong",{parentName:"p"},"IN865"),".")),(0,r.yg)("p",null,'The Helium IOT Network uses the LoRaWAN protocol to provide internet connectivity to "Internet of Things" devices and is the original sub network in the Helium ecosystem. Developers and companies around the world rely on the Helium IOT Network for connectivity.'),(0,r.yg)("h3",{id:"helium-iot-console-prepration"},"Helium IoT Console Prepration"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},"Step 1.")," Visit ",(0,r.yg)("a",{parentName:"li",href:"https://console.helium.com/welcome"},"Helium Console")," website and sign up for a new account")),(0,r.yg)("p",{style:{textAlign:"center"}},(0,r.yg)("img",{src:"https://raw.githubusercontent.com/salmanfarisvp/resource/main/Images/LoRa/Helium/Networksetup/Helium-login.png",alt:"pir",width:500,height:"auto"})),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},"Step 2."),' After logging in, click "Devices" to manage devices. ')),(0,r.yg)("p",{style:{textAlign:"center"}},(0,r.yg)("img",{src:"https://raw.githubusercontent.com/salmanfarisvp/resource/main/Images/LoRa/Helium/Networksetup/Device.png",alt:"pir",width:1e3,height:"auto"})),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},"Step 3."),' Then click on "Add New Device"')),(0,r.yg)("p",{style:{textAlign:"center"}},(0,r.yg)("img",{src:"https://raw.githubusercontent.com/salmanfarisvp/resource/main/Images/LoRa/Helium/Networksetup/CreateaDevice01.png",alt:"pir",width:"1000",height:"auto"})),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},"Step 4.")," Here, ",(0,r.yg)("strong",{parentName:"li"},"1) Add device a new")," , ",(0,r.yg)("strong",{parentName:"li"},"2) Copy the Dev EUI")," , ",(0,r.yg)("strong",{parentName:"li"},"3) Copy the App EUI"),", ",(0,r.yg)("strong",{parentName:"li"},"4) Copy the App Key"),", ",(0,r.yg)("strong",{parentName:"li"},"5) Finally Click Save"),".")),(0,r.yg)("p",{style:{textAlign:"center"}},(0,r.yg)("img",{src:"https://raw.githubusercontent.com/salmanfarisvp/resource/main/Images/LoRa/Helium/Networksetup/Id01.png",alt:"pir",width:"1000",height:"auto"})),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},"Step 5."),' Now you can see the device under the "Devices" section. ')),(0,r.yg)("p",{style:{textAlign:"center"}},(0,r.yg)("img",{src:"https://raw.githubusercontent.com/salmanfarisvp/resource/main/Images/LoRa/Helium/Networksetup/Device02.png",alt:"pir",width:"1000",height:"auto"})),(0,r.yg)("p",null,"Now, the helium console setup is done. we can move to the Software part and upload data to the helium console over the helium LoRa network. "),(0,r.yg)("h2",{id:"hardware-preparation"},"Hardware Preparation."),(0,r.yg)("p",null,"Place the XIAO nRF52840 BLE Sense to the Seeeduino XIAO Expansion board and then Connect the Grove - Wio E5  to the XIAO Expansion board UART Port. "),(0,r.yg)("p",{style:{textAlign:"center"}},(0,r.yg)("img",{src:"https://raw.githubusercontent.com/salmanfarisvp/TinyML/main/XIAO-nRF52840-Sense/src/img/XIAO_LoRa.png",alt:"pir",width:400,height:"auto"})),(0,r.yg)("h2",{id:"software-preparation"},"Software Preparation."),(0,r.yg)("p",null,"We developed the tinyML model using the Edge impulse tool, and you can find the dataset and project details ",(0,r.yg)("a",{parentName:"p",href:"https://studio.edgeimpulse.com/public/283541/latest"},"here"),", you can also clone the project and do the modfications as per your need. "),(0,r.yg)("p",{style:{textAlign:"center"}},(0,r.yg)("img",{src:"https://raw.githubusercontent.com/salmanfarisvp/TinyML/main/XIAO-nRF52840-Sense/src/img/Edge_Impulse_project.png",alt:"pir",width:800,height:"auto"})),(0,r.yg)("p",null,"For now, download the Edge Impulse tinyML library from ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/salmanfarisvp/TinyML/blob/main/XIAO-nRF52840-Sense/src/lib/ei-illegal-logging-detection--vehicle-sound-xiao-nrf52-arduino-1.0.4.zip"},"here")," and add it the arduino. Follow ",(0,r.yg)("a",{parentName:"p",href:"https://wiki.seeedstudio.com/How_to_install_Arduino_Library/#1add-zip-library"},"this guide")," to learn how to add ZIP libraries."),(0,r.yg)("p",null,"After adding the library, copy the code below and past in to your arduino sketch and ",(0,r.yg)("strong",{parentName:"p"},"replace the helium LoRa WAN Credentials"),". "),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-cpp"},'/* Edge Impulse ingestion SDK\n * Copyright (c) 2022 EdgeImpulse Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\n// If your target is limited in memory remove this macro to save 10K RAM\n#define EIDSP_QUANTIZE_FILTERBANK 0\n\n/*\n ** NOTE: If you run into TFLite arena allocation issue.\n **\n ** This may be due to may dynamic memory fragmentation.\n ** Try defining "-DEI_CLASSIFIER_ALLOCATION_STATIC" in boards.local.txt (create\n ** if it doesn\'t exist) and copy this file to\n ** `<ARDUINO_CORE_INSTALL_PATH>/arduino/hardware/<mbed_core>/<core_version>/`.\n **\n ** See\n ** (https://support.arduino.cc/hc/en-us/articles/360012076960-Where-are-the-installed-cores-located-)\n ** to find where Arduino installs cores on your machine.\n **\n ** If the problem persists then there\'s not enough memory for this model and application.\n */\n\n\n /*\n** Developed by Salman Faris \n** Date: 20/09/2023\n */\n\n\n\n/* Includes ---------------------------------------------------------------- */\n#include <PDM.h>\n#include <Illegal_Logging_Detection_-_Vehicle_sound_-_XIAO-nRF52_inferencing.h>\n#include <Arduino.h>\n#include <U8x8lib.h>\n\nU8X8_SSD1306_128X64_NONAME_HW_I2C u8x8(/*reset=*/U8X8_PIN_NONE);\n\n/** Audio buffers, pointers and selectors */\ntypedef struct {\n  int16_t *buffer;\n  uint8_t buf_ready;\n  uint32_t buf_count;\n  uint32_t n_samples;\n} inference_t;\n\nstatic inference_t inference;\nstatic signed short sampleBuffer[2048];\nstatic bool debug_nn = false;  // Set this to true to see e.g. features generated from the raw signal\n\n//LoRa Buffer\nstatic char recv_buf[512];\nstatic bool is_exist = false;\nstatic bool is_join = false;\nstatic int led = 0;\n\n//Inference Data\nint pred_index = 0;    // Initialize pred_index\nfloat pred_value = 0;  // Initialize pred_value\n\nstatic int at_send_check_response(char *p_ack, int timeout_ms, char *p_cmd, ...) {\n  int ch;\n  int num = 0;\n  int index = 0;\n  int startMillis = 0;\n  va_list args;\n  char cmd_buffer[256];  // Adjust the buffer size as needed\n  memset(recv_buf, 0, sizeof(recv_buf));\n  va_start(args, p_cmd);\n  vsprintf(cmd_buffer, p_cmd, args);  // Format the command string\n  Serial1.print(cmd_buffer);\n  Serial.print(cmd_buffer);\n  va_end(args);\n  delay(200);\n  startMillis = millis();\n\n  if (p_ack == NULL) {\n    return 0;\n  }\n\n  do {\n    while (Serial1.available() > 0) {\n      ch = Serial1.read();\n      recv_buf[index++] = ch;\n      Serial.print((char)ch);\n      delay(2);\n    }\n\n    if (strstr(recv_buf, p_ack) != NULL) {\n      return 1;\n    }\n\n  } while (millis() - startMillis < timeout_ms);\n  return 0;\n}\n\nstatic void recv_prase(char *p_msg) {\n  if (p_msg == NULL) {\n    return;\n  }\n  char *p_start = NULL;\n  int data = 0;\n  int rssi = 0;\n  int snr = 0;\n\n  p_start = strstr(p_msg, "RX");\n  if (p_start && (1 == sscanf(p_start, "RX: \\"%d\\"\\r\\n", &data))) {\n    Serial.println(data);\n    u8x8.setCursor(2, 4);\n    u8x8.print("led :");\n    led = !!data;\n    u8x8.print(led);\n    if (led) {\n      digitalWrite(LED_BUILTIN, LOW);\n    } else {\n      digitalWrite(LED_BUILTIN, HIGH);\n    }\n  }\n\n  p_start = strstr(p_msg, "RSSI");\n  if (p_start && (1 == sscanf(p_start, "RSSI %d,", &rssi))) {\n    u8x8.setCursor(0, 6);\n    u8x8.print("                ");\n    u8x8.setCursor(2, 6);\n    u8x8.print("rssi:");\n    u8x8.print(rssi);\n  }\n  p_start = strstr(p_msg, "SNR");\n  if (p_start && (1 == sscanf(p_start, "SNR %d", &snr))) {\n    u8x8.setCursor(0, 7);\n    u8x8.print("                ");\n    u8x8.setCursor(2, 7);\n    u8x8.print("snr :");\n    u8x8.print(snr);\n  }\n}\n\n\n/**\n * @brief      Arduino setup function\n */\nvoid setup() {\n  // put your setup code here, to run once:\n  Serial.begin(115200);\n  Serial1.begin(9600);\n  // comment out the below line to cancel the wait for USB connection (needed for native USB)\n  while (!Serial)\n    ;\n  Serial.println("Edge Impulse Inferencing Demo");\n\n  // summary of inferencing settings (from model_metadata.h)\n  ei_printf("Inferencing settings:\\n");\n  ei_printf("\\tInterval: %.2f ms.\\n", (float)EI_CLASSIFIER_INTERVAL_MS);\n  ei_printf("\\tFrame size: %d\\n", EI_CLASSIFIER_DSP_INPUT_FRAME_SIZE);\n  ei_printf("\\tSample length: %d ms.\\n", EI_CLASSIFIER_RAW_SAMPLE_COUNT / 16);\n  ei_printf("\\tNo. of classes: %d\\n", sizeof(ei_classifier_inferencing_categories) / sizeof(ei_classifier_inferencing_categories[0]));\n\n  if (microphone_inference_start(EI_CLASSIFIER_RAW_SAMPLE_COUNT) == false) {\n    ei_printf("ERR: Could not allocate audio buffer (size %d), this could be due to the window length of your model\\r\\n", EI_CLASSIFIER_RAW_SAMPLE_COUNT);\n    return;\n  }\n\n\n  u8x8.begin();\n  u8x8.setFlipMode(1);\n  u8x8.setFont(u8x8_font_chroma48medium8_r);\n\n  Serial.begin(115200);\n  pinMode(LED_BUILTIN, OUTPUT);\n  digitalWrite(LED_BUILTIN, HIGH);\n\n  Serial1.begin(9600);\n  Serial.print("E5 LORAWAN TEST\\r\\n");\n  u8x8.setCursor(0, 0);\n\n  if (at_send_check_response("+AT: OK", 100, "AT\\r\\n")) {\n    is_exist = true;\n    at_send_check_response("+ID: DevEui", 1000, "AT+ID=DevEui,\\"XXXXXXXXXX"\\r\\n");\n    at_send_check_response("+ID: AppEui", 1000, "AT+ID=AppEui,\\"XXXXXXXXXXX\\"\\r\\n");\n    at_send_check_response("+KEY: APPKEY", 1000, "AT+KEY=APPKEY,\\"XXXXXXXXXXXX\\"\\r\\n");\n    at_send_check_response("+ID: DevAddr", 1000, "AT+ID=DevAddr\\r\\n");\n    at_send_check_response("+ID: AppEui", 1000, "AT+ID\\r\\n");\n    at_send_check_response("+MODE: LWOTAA", 1000, "AT+MODE=LWOTAA\\r\\n");\n    at_send_check_response("+DR: IN865", 1000, "AT+DR=IN865\\r\\n");\n    at_send_check_response("+CH: NUM", 1000, "AT+CH=NUM,0-2\\r\\n");\n    at_send_check_response("+CLASS: A", 1000, "AT+CLASS=A\\r\\n");\n    at_send_check_response("+PORT: 8", 1000, "AT+PORT=8\\r\\n");\n    delay(200);\n    u8x8.setCursor(5, 0);\n    u8x8.print("LoRaWAN");\n    is_join = true;\n  } else {\n    is_exist = false;\n    Serial.print("No E5 module found.\\r\\n");\n    u8x8.setCursor(0, 1);\n    u8x8.print("unfound E5 !");\n  }\n\n  //dht.begin();\n}\n\n/**\n * @brief      Arduino main function. Runs the inferencing loop.\n */\nvoid loop() {\n  ei_printf("Starting inferencing in 2 seconds...\\n");\n\n  delay(2000);\n\n  ei_printf("Recording...\\n");\n\n  bool m = microphone_inference_record();\n  if (!m) {\n    ei_printf("ERR: Failed to record audio...\\n");\n    return;\n  }\n\n  ei_printf("Recording done\\n");\n\n  signal_t signal;\n  signal.total_length = EI_CLASSIFIER_RAW_SAMPLE_COUNT;\n  signal.get_data = &microphone_audio_signal_get_data;\n  ei_impulse_result_t result = { 0 };\n\n  EI_IMPULSE_ERROR r = run_classifier(&signal, &result, debug_nn);\n  if (r != EI_IMPULSE_OK) {\n    ei_printf("ERR: Failed to run classifier (%d)\\n", r);\n    return;\n  }\n\n\n  int pred_index = 0;    // Initialize pred_index\n  float pred_value = 0;  // Initialize pred_value\n\n  // print the predictions\n  ei_printf("Predictions ");\n  ei_printf("(DSP: %d ms., Classification: %d ms., Anomaly: %d ms.)",\n            result.timing.dsp, result.timing.classification, result.timing.anomaly);\n  ei_printf(": \\n");\n\n  for (size_t ix = 0; ix < EI_CLASSIFIER_LABEL_COUNT; ix++) {\n    ei_printf("    %s: %.5f\\n", result.classification[ix].label, result.classification[ix].value);\n    ei_printf("\\n");\n    if (result.classification[ix].value > pred_value) {\n      pred_index = ix;\n      pred_value = result.classification[ix].value;\n    }\n  }\n\n\n  // Display inference result and Send message to Helium Console. \n  if ((pred_index == 1 && (pred_value > 0.8))) {\n    ei_printf("Vehicle Sound is Detected ");\n    ei_printf("\\n");\n    int SOS = 10;\n    int DeviceID = 1;\n    if (is_exist) {\n      int ret = 0;\n      if (is_join) {\n\n        ret = at_send_check_response("+JOIN: Network joined", 12000, "AT+JOIN\\r\\n");\n        if (ret) {\n          is_join = false;\n        } else {\n          at_send_check_response("+ID: AppEui", 1000, "AT+ID\\r\\n");\n          Serial.print("JOIN failed!\\r\\n\\r\\n");\n          delay(5000);\n        }\n      } else {\n        char cmd[128];\n        sprintf(cmd, "AT+CMSGHEX=\\"%04X%04X\\"\\r\\n", (int)DeviceID, (int)SOS);\n        ret = at_send_check_response("Done", 5000, cmd);\n\n        u8x8.setCursor(0, 2);\n        u8x8.print("      ");\n        u8x8.setCursor(2, 2);\n        u8x8.print("Vehicle Detected");\n        u8x8.setCursor(2, 3);\n        u8x8.print("Sending SOS");\n        if (ret) {\n          recv_prase(recv_buf);\n        } else {\n          Serial.print("Send failed!\\r\\n\\r\\n");\n        }\n        delay(5000);\n      }\n    } else {\n      delay(1000);\n    }\n\n  }\n  else {\n        u8x8.setCursor(0, 2);\n        u8x8.print("      ");\n        u8x8.setCursor(2, 2);\n        u8x8.print("Normal Condition");\n        u8x8.setCursor(2, 3);\n        u8x8.print("idle");\n  }\n\n#if EI_CLASSIFIER_HAS_ANOMALY == 1\n  ei_printf("    anomaly score: %.3f\\n", result.anomaly);\n#endif\n}\n\n/**\n * @brief      PDM buffer full callback\n *             Get data and call audio thread callback\n */\nstatic void pdm_data_ready_inference_callback(void) {\n  int bytesAvailable = PDM.available();\n\n  // read into the sample buffer\n  int bytesRead = PDM.read((char *)&sampleBuffer[0], bytesAvailable);\n\n  if (inference.buf_ready == 0) {\n    for (int i = 0; i < bytesRead >> 1; i++) {\n      inference.buffer[inference.buf_count++] = sampleBuffer[i];\n\n      if (inference.buf_count >= inference.n_samples) {\n        inference.buf_count = 0;\n        inference.buf_ready = 1;\n        break;\n      }\n    }\n  }\n}\n\n/**\n * @brief      Init inferencing struct and setup/start PDM\n *\n * @param[in]  n_samples  The n samples\n *\n * @return     { description_of_the_return_value }\n */\nstatic bool microphone_inference_start(uint32_t n_samples) {\n  inference.buffer = (int16_t *)malloc(n_samples * sizeof(int16_t));\n\n  if (inference.buffer == NULL) {\n    return false;\n  }\n\n  inference.buf_count = 0;\n  inference.n_samples = n_samples;\n  inference.buf_ready = 0;\n\n  // configure the data receive callback\n  PDM.onReceive(&pdm_data_ready_inference_callback);\n\n  PDM.setBufferSize(4096);\n\n  // initialize PDM with:\n  // - one channel (mono mode)\n  // - a 16 kHz sample rate\n  if (!PDM.begin(1, EI_CLASSIFIER_FREQUENCY)) {\n    ei_printf("Failed to start PDM!");\n    microphone_inference_end();\n\n    return false;\n  }\n\n  // set the gain, defaults to 20\n  PDM.setGain(127);\n\n  return true;\n}\n\n/**\n * @brief      Wait on new data\n *\n * @return     True when finished\n */\nstatic bool microphone_inference_record(void) {\n  inference.buf_ready = 0;\n  inference.buf_count = 0;\n\n  while (inference.buf_ready == 0) {\n    delay(10);\n  }\n\n  return true;\n}\n\n/**\n * Get raw audio signal data\n */\nstatic int microphone_audio_signal_get_data(size_t offset, size_t length, float *out_ptr) {\n  numpy::int16_to_float(&inference.buffer[offset], out_ptr, length);\n\n  return 0;\n}\n\n/**h\n * @brief      Stop PDM and release buffers\n */\nstatic void microphone_inference_end(void) {\n  PDM.end();\n  free(inference.buffer);\n}\n\n#if !defined(EI_CLASSIFIER_SENSOR) || EI_CLASSIFIER_SENSOR != EI_CLASSIFIER_SENSOR_MICROPHONE\n#error "Invalid model for current sensor."\n#endif\n\n')),(0,r.yg)("p",null,"Reaplace the ",(0,r.yg)("strong",{parentName:"p"},"DevEUI , AppEUI")," and ",(0,r.yg)("strong",{parentName:"p"},"APPKEY")," with your credentails obtained from the Helium console. Also make sure to replace the ",(0,r.yg)("strong",{parentName:"p"},"IN865")," as per your region FREQ plan. "),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-cpp"},'at_send_check_response("+ID: DevEui", 1000, "AT+ID=DevEui,\\"xxxxxxxxxxx\\"\\r\\n");\nat_send_check_response("+ID: AppEui", 1000, "AT+ID=AppEui,\\"xxxxxxxxxxx\\"\\r\\n");\nat_send_check_response("+KEY: APPKEY", 1000, "AT+KEY=APPKEY,\\"xxxxxxxxxxxxxxx\\"\\r\\n");\nat_send_check_response("+ID: DevAddr", 1000, "AT+ID=DevAddr\\r\\n");\nat_send_check_response("+ID: AppEui", 1000, "AT+ID\\r\\n");\nat_send_check_response("+MODE: LWOTAA", 1000, "AT+MODE=LWOTAA\\r\\n");\nat_send_check_response("+DR: IN865", 1000, "AT+DR=IN865\\r\\n");\nat_send_check_response("+CH: NUM", 1000, "AT+CH=NUM,0-2\\r\\n");\nat_send_check_response("+CLASS: A", 1000, "AT+CLASS=A\\r\\n");\nat_send_check_response("+PORT: 8", 1000, "AT+PORT=8\\r\\n");\n')),(0,r.yg)("p",null,"In the below section, you can see the XIAO will check if there any ",(0,r.yg)("strong",{parentName:"p"},"Vehicle sound detected")," and if it's detected,it will establish an LoRa WAN Connection to the helium console and send data ",(0,r.yg)("strong",{parentName:"p"},"1")," as ",(0,r.yg)("strong",{parentName:"p"},"Vehicle Sound is Detected")," symbol. "),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-cpp"},'// Display inference result and Send message to Helium Console. \n  if ((pred_index == 1 && (pred_value > 0.8))) {\n    ei_printf("Vehicle Sound is Detected ");\n    ei_printf("\\n");\n    int SOS = 10;\n    int DeviceID = 1;\n    if (is_exist) {\n      int ret = 0;\n      if (is_join) {\n\n        ret = at_send_check_response("+JOIN: Network joined", 12000, "AT+JOIN\\r\\n");\n        if (ret) {\n          is_join = false;\n        } else {\n          at_send_check_response("+ID: AppEui", 1000, "AT+ID\\r\\n");\n          Serial.print("JOIN failed!\\r\\n\\r\\n");\n          delay(5000);\n        }\n      } else {\n        char cmd[128];\n        sprintf(cmd, "AT+CMSGHEX=\\"%04X%04X\\"\\r\\n", (int)DeviceID, (int)SOS);\n        ret = at_send_check_response("Done", 5000, cmd);\n\n        u8x8.setCursor(0, 2);\n        u8x8.print("      ");\n        u8x8.setCursor(2, 2);\n        u8x8.print("Vehicle Detected");\n        u8x8.setCursor(2, 3);\n        u8x8.print("Sending SOS");\n        if (ret) {\n          recv_prase(recv_buf);\n        } else {\n          Serial.print("Send failed!\\r\\n\\r\\n");\n        }\n        delay(5000);\n      }\n    } else {\n      delay(1000);\n    }\n\n  }\n  else {\n        u8x8.setCursor(0, 2);\n        u8x8.print("      ");\n        u8x8.setCursor(2, 2);\n        u8x8.print("Normal Condition");\n        u8x8.setCursor(2, 3);\n        u8x8.print("idle");\n  }\n')),(0,r.yg)("h2",{id:"demo"},"Demo"),(0,r.yg)("admonition",{type:"note"},(0,r.yg)("p",{parentName:"admonition"},"Make sure you are inside the helium network coverage. You can find the network coverage at ",(0,r.yg)("a",{parentName:"p",href:"https://explorer.helium.com/"},"explorer.helium.com"))),(0,r.yg)("p",null,'After uploading the code, The XIAO nRF52840 Sense will capture sound and check if there is any engine sound using tinyML, so try to play engine sound to trigger the action. Once it\'s detect the engine sound (1), XIAO will establish the Helium LoRa network connection and send command "1" as ',(0,r.yg)("strong",{parentName:"p"},"Vehicle Sound is Detected")," symbol (2). "),(0,r.yg)("p",{style:{textAlign:"center"}},(0,r.yg)("img",{src:"https://raw.githubusercontent.com/salmanfarisvp/TinyML/main/XIAO-nRF52840-Sense/src/img/Infer_engine_sound.png",alt:"pir",width:1e3,height:"auto"})),(0,r.yg)("p",null,"You can see the data over the helium console and it's debug window. "),(0,r.yg)("p",{style:{textAlign:"center"}},(0,r.yg)("img",{src:"https://raw.githubusercontent.com/salmanfarisvp/TinyML/main/XIAO-nRF52840-Sense/src/img/helium-debug.png",alt:"pir",width:1e3,height:"auto"})),(0,r.yg)("h2",{id:"todo"},"ToDo"),(0,r.yg)("p",null,"So far, we made intergration with tinyML and LoRa. and we have few to-dos that you can work as exercise to improve the project. "),(0,r.yg)("ul",{className:"contains-task-list"},(0,r.yg)("li",{parentName:"ul",className:"task-list-item"},(0,r.yg)("input",{parentName:"li",type:"checkbox",checked:!1,disabled:!0})," ","Intergrate the helium console with dashboard and vishualize the data "),(0,r.yg)("li",{parentName:"ul",className:"task-list-item"},(0,r.yg)("input",{parentName:"li",type:"checkbox",checked:!1,disabled:!0})," ","Create Email/SMS/Phone Alert with custom dashboard to inform forest ranger. ")),(0,r.yg)("h2",{id:"resources"},"Resources"),(0,r.yg)("p",null,"Datasheet:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",null,(0,r.yg)("a",{href:"http://files.seeedstudio.com/products/113020091/Grove%20-%20LoRa%20-E5%20v1.0.brd"},"Grove Wio-E5 v1.0.brd"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",null,(0,r.yg)("a",{href:"https://files.seeedstudio.com/products/113020091/Grove%20-%20LoRa%20-E5%20v1.0.pdf"},"Grove Wio-E5 v1.0.pdf"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",null,(0,r.yg)("a",{href:"http://files.seeedstudio.com/products/113020091/Grove%20-%20LoRa%20-E5%20v1.0.sch"},"Grove Wio-E5 v1.0.sch"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",null,(0,r.yg)("a",{href:"https://files.seeedstudio.com/products/317990687/res/LoRa-E5%20module%20datasheet_V1.0.pdf"},"Wio-E5 datasheet and specifications"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",null,(0,r.yg)("a",{href:"https://files.seeedstudio.com/products/317990687/res/LoRa-E5%20AT%20Command%20Specification_V1.0%20.pdf"},"Wio-E5 AT Command Specification"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",null,(0,r.yg)("a",{href:"https://files.seeedstudio.com/products/317990687/res/STM32WLE5JC%20Datasheet.pdf"},"STM32WLE5JC Datasheet")))),(0,r.yg)("p",null,"Certifications:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",null,(0,r.yg)("a",{href:"https://files.seeedstudio.com/products/317990687/res/LoRa-E5-HF%20Certification%20CE-VOC-RED.pdf"},"Wio-E5-HF Certification CE-VOC-RED"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",null,(0,r.yg)("a",{href:"https://files.seeedstudio.com/products/317990687/res/LoRa-E5-HF%20FCC%20Certification%20-DSS.pdf"},"Wio-E5-HF FCC Certification -DSS"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",null,(0,r.yg)("a",{href:"https://files.seeedstudio.com/products/317990687/res/LoRa-E5-HF%20FCC%20Certification%20-DTS.pdf"},"Wio-E5-HF FCC Certification -DTS")))),(0,r.yg)("p",null,"Relevant SDK:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",null,(0,r.yg)("a",{href:"https://my.st.com/content/my_st_com/en/products/embedded-software/mcu-mpu-embedded-software/stm32-embedded-software/stm32cube-mcu-mpu-packages/stm32cubewl.license=1608693595598.product=STM32CubeWL.version=1.0.0.html#overview",target:"_blank"},"STM32Cube MCU Package for STM32WL series")))),(0,r.yg)("div",{id:"gtx-trans",style:{position:"absolute",left:"-36px",top:"48.875px"}},(0,r.yg)("div",{className:"gtx-trans-icon"})),(0,r.yg)("h2",{id:"tech-support--product-discussion"},"Tech Support & Product Discussion"),(0,r.yg)("p",null,"Thank you for choosing our products! We are here to provide you with different support to ensure that your experience with our products is as smooth as possible. We offer several communication channels to cater to different preferences and needs."),(0,r.yg)("div",{class:"button_tech_support_container"},(0,r.yg)("a",{href:"https://forum.seeedstudio.com/",class:"button_forum"}),(0,r.yg)("a",{href:"https://www.seeedstudio.com/contacts",class:"button_email"})),(0,r.yg)("div",{class:"button_tech_support_container"},(0,r.yg)("a",{href:"https://discord.gg/eWkprNDMU7",class:"button_discord"}),(0,r.yg)("a",{href:"https://github.com/Seeed-Studio/wiki-documents/discussions/69",class:"button_discussion"})))}c.isMDXComponent=!0}}]);