"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[23705],{15680:(e,t,n)=>{n.d(t,{xA:()=>g,yg:()=>y});var i=n(96540);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=i.createContext({}),c=function(e){var t=i.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},g=function(e){var t=c(e.components);return i.createElement(l.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},u=i.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,g=r(e,["components","mdxType","originalType","parentName"]),p=c(n),u=o,y=p["".concat(l,".").concat(u)]||p[u]||d[u]||a;return n?i.createElement(y,s(s({ref:t},g),{},{components:n})):i.createElement(y,s({ref:t},g))}));function y(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,s=new Array(a);s[0]=u;var r={};for(var l in t)hasOwnProperty.call(t,l)&&(r[l]=t[l]);r.originalType=e,r[p]="string"==typeof e?e:o,s[1]=r;for(var c=2;c<a;c++)s[c]=n[c];return i.createElement.apply(null,s)}return i.createElement.apply(null,n)}u.displayName="MDXCreateElement"},45800:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>a,metadata:()=>r,toc:()=>c});var i=n(58168),o=(n(96540),n(15680));const a={description:"Use XIAO ESP32C6 and sensors with AWS IoT Core to implement AI devices that can do anomaly detection.",title:"Empowering AI with AWS IoT Core for the XIAO ESP32C6",keywords:["xiao esp32c6"],image:"https://files.seeedstudio.com/wiki/seeed_logo/logo_2023.png",slug:"/xiao_esp32c6_aws_iot",last_update:{date:"03/29/2024",author:"Citric"}},s="Empowering AI with AWS IoT Core for the XIAO ESP32C6",r={unversionedId:"Sensor/SeeedStudio_XIAO/SeeedStudio_XIAO_ESP32C6/Application/xiao_esp32c6_aws_iot",id:"Sensor/SeeedStudio_XIAO/SeeedStudio_XIAO_ESP32C6/Application/xiao_esp32c6_aws_iot",title:"Empowering AI with AWS IoT Core for the XIAO ESP32C6",description:"Use XIAO ESP32C6 and sensors with AWS IoT Core to implement AI devices that can do anomaly detection.",source:"@site/docs/Sensor/SeeedStudio_XIAO/SeeedStudio_XIAO_ESP32C6/Application/xiao_esp32c6_aws_iot.md",sourceDirName:"Sensor/SeeedStudio_XIAO/SeeedStudio_XIAO_ESP32C6/Application",slug:"/xiao_esp32c6_aws_iot",permalink:"/xiao_esp32c6_aws_iot",draft:!1,editUrl:"https://github.com/Seeed-Studio/wiki-documents/blob/docusaurus-version/docs/Sensor/SeeedStudio_XIAO/SeeedStudio_XIAO_ESP32C6/Application/xiao_esp32c6_aws_iot.md",tags:[],version:"current",lastUpdatedBy:"Citric",lastUpdatedAt:1711670400,formattedLastUpdatedAt:"Mar 29, 2024",frontMatter:{description:"Use XIAO ESP32C6 and sensors with AWS IoT Core to implement AI devices that can do anomaly detection.",title:"Empowering AI with AWS IoT Core for the XIAO ESP32C6",keywords:["xiao esp32c6"],image:"https://files.seeedstudio.com/wiki/seeed_logo/logo_2023.png",slug:"/xiao_esp32c6_aws_iot",last_update:{date:"03/29/2024",author:"Citric"}},sidebar:"ProductSidebar",previous:{title:"Bluetooth Usage",permalink:"/xiao_esp32c6_bluetooth"},next:{title:"Real-time IoT Data Processing Node Powered By Apache Kafka",permalink:"/xiao_esp32c6_kafka"}},l={},c=[{value:"Materials Required",id:"materials-required",level:2},{value:"Capture sensor data to AWS IoT Core",id:"capture-sensor-data-to-aws-iot-core",level:2},{value:"Step 1. Create a Thing",id:"step-1-create-a-thing",level:3},{value:"Step 2. Preparation of headers based on certificates",id:"step-2-preparation-of-headers-based-on-certificates",level:3},{value:"Step 3. Upload data acquisition programme for XIAO ESP32C6",id:"step-3-upload-data-acquisition-programme-for-xiao-esp32c6",level:3},{value:"Step 4. MQTT test client",id:"step-4-mqtt-test-client",level:3},{value:"Store the data using AWS Analytics",id:"store-the-data-using-aws-analytics",level:2},{value:"Step 5. Configure AWS IoT Analytics",id:"step-5-configure-aws-iot-analytics",level:3},{value:"Step 6. Create a rule",id:"step-6-create-a-rule",level:3},{value:"Step 7. Stores sensor data streams",id:"step-7-stores-sensor-data-streams",level:3},{value:"Use AWS Sagemaker to train data in normal environments",id:"use-aws-sagemaker-to-train-data-in-normal-environments",level:2},{value:"Step 8. Create a new notebook instance",id:"step-8-create-a-new-notebook-instance",level:3},{value:"Step 9: Run all Jupyter Notebook",id:"step-9-run-all-jupyter-notebook",level:3},{value:"Step 10. Configure AWS Lambda",id:"step-10-configure-aws-lambda",level:3},{value:"Additional Considerations",id:"additional-considerations",level:3},{value:"Abnormal status message notification",id:"abnormal-status-message-notification",level:2},{value:"Step 11. Configuring Amazon SNS",id:"step-11-configuring-amazon-sns",level:3},{value:"Step 12. Give SNS permissions to Lambda",id:"step-12-give-sns-permissions-to-lambda",level:3},{value:"Step 13. Configuring API Gateway",id:"step-13-configuring-api-gateway",level:3},{value:"XIAO ESP32C6 for abnormal environment detection",id:"xiao-esp32c6-for-abnormal-environment-detection",level:2},{value:"Step 14. Upload real-time data reporting program for XIAO ESP32C6",id:"step-14-upload-real-time-data-reporting-program-for-xiao-esp32c6",level:3},{value:"Tech Support &amp; Product Discussion",id:"tech-support--product-discussion",level:2}],g={toc:c},p="wrapper";function d(e){let{components:t,...n}=e;return(0,o.yg)(p,(0,i.A)({},g,n,{components:t,mdxType:"MDXLayout"}),(0,o.yg)("h1",{id:"empowering-ai-with-aws-iot-core-for-the-xiao-esp32c6"},"Empowering AI with AWS IoT Core for the XIAO ESP32C6"),(0,o.yg)("p",null,"This Wiki serves as a comprehensive guide to deploying an advanced IoT system that harnesses the power of AWS services and the XIAO ESP32C6 microcontroller to monitor and analyze environmental data. Beginning with the seamless collection of sensor data, this documentation navigates through the intricacies of transmitting and storing this information on AWS IoT Core and AWS Analytics, respectively. It delves into the utilization of AWS Sagemaker to train machine learning models on normal environmental patterns, emphasizing the system's capability to learn and adapt to its operational context for enhanced efficiency."),(0,o.yg)("p",null,"Furthermore, the Wiki outlines the implementation of real-time anomaly detection using the XIAO ESP32C6, a critical component that actively scans for deviations from the norm and swiftly triggers alerts. It encapsulates the end-to-end process of setting up an alerting mechanism that notifies stakeholders of abnormal conditions, ensuring prompt attention and action. "),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/0.jpg",style:{width:1e3,height:"auto"}})),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"#capture-sensor-data-to-aws-iot-core"},(0,o.yg)("strong",{parentName:"a"},"Capture sensor data to AWS IoT Core")),"."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"#store-the-data-using-aws-analytics"},(0,o.yg)("strong",{parentName:"a"},"Store the data using AWS Analytics")),"."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"#use-aws-sagemaker-to-train-data-in-normal-environments"},(0,o.yg)("strong",{parentName:"a"},"Use AWS Sagemaker to train data in normal environments")),"."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"#xiao-esp32c6-for-abnormal-environment-detection"},(0,o.yg)("strong",{parentName:"a"},"XIAO ESP32C6 for abnormal environment detection")),"."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"#abnormal-status-message-notification"},(0,o.yg)("strong",{parentName:"a"},"Abnormal status message notification")),".")),(0,o.yg)("p",null,"By exploring this Wiki, users will gain a detailed understanding of each component's role in creating a smart, responsive, and robust environmental monitoring system, complete with practical insights into configuration and maintenance."),(0,o.yg)("h2",{id:"materials-required"},"Materials Required"),(0,o.yg)("p",null,"This example will introduce the use of XIAO ESP32C6 with Grove DHT20 temperature and humidity sensor to complete the SageMaker task of AWS IoT Core. Below are all the hardware devices needed to complete this routine."),(0,o.yg)("div",{class:"table-center"},(0,o.yg)("table",{align:"center"},(0,o.yg)("tr",null,(0,o.yg)("th",null,"XIAO ESP32C6"),(0,o.yg)("th",null,"DHT20"),(0,o.yg)("th",null,"Extension Board")),(0,o.yg)("tr",null,(0,o.yg)("td",null,(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/SeeedStudio-XIAO-ESP32C6/img/xiaoc6.jpg",style:{width:250,height:"auto"}}))),(0,o.yg)("td",null,(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/Grove-Temperature-Humidity-Sensor/Tem-humidity-sensor1.jpg",style:{width:250,height:"auto"}}))),(0,o.yg)("td",null,(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao_esp32c6_kafka/extensionboard.jpg",style:{width:250,height:"auto"}})))),(0,o.yg)("tr",null,(0,o.yg)("td",null,(0,o.yg)("div",{class:"get_one_now_container",style:{textAlign:"center"}},(0,o.yg)("a",{class:"get_one_now_item",href:"https://www.seeedstudio.com/Seeed-Studio-XIAO-ESP32C6-p-5884.html"},(0,o.yg)("strong",null,(0,o.yg)("span",null,(0,o.yg)("font",{color:"FFFFFF",size:"4"}," Get One Now \ud83d\uddb1\ufe0f")))))),(0,o.yg)("td",null,(0,o.yg)("div",{class:"get_one_now_container",style:{textAlign:"center"}},(0,o.yg)("a",{class:"get_one_now_item",href:"https://www.seeedstudio.com/Grove-Temperature-Humidity-Sensor-V2-0-DHT20-p-4967.html"},(0,o.yg)("strong",null,(0,o.yg)("span",null,(0,o.yg)("font",{color:"FFFFFF",size:"4"}," Get One Now \ud83d\uddb1\ufe0f")))))),(0,o.yg)("td",null,(0,o.yg)("div",{class:"get_one_now_container",style:{textAlign:"center"}},(0,o.yg)("a",{class:"get_one_now_item",href:"https://www.seeedstudio.com/Grove-Shield-for-Seeeduino-XIAO-p-4621.html"},(0,o.yg)("strong",null,(0,o.yg)("span",null,(0,o.yg)("font",{color:"FFFFFF",size:"4"}," Get One Now \ud83d\uddb1\ufe0f"))))))))),(0,o.yg)("h2",{id:"capture-sensor-data-to-aws-iot-core"},"Capture sensor data to AWS IoT Core"),(0,o.yg)("p",null,"We leverage a multitude of sensors interfaced with the XIAO ESP32C6 board to collect environmental data in real time and upload it to AWS IoT Core. This provides us with a reliable and secure method to handle the vast streams of data emerging from the various sensors."),(0,o.yg)("p",null,'To register for AWS IoT Core and create a Thing named "XIAO_ESP32C6", follow the steps below. Please note that this process assumes you already have an Amazon Web Services account. If you do not, you will need to ',(0,o.yg)("a",{parentName:"p",href:"https://aws.amazon.com/"},"create one")," before proceeding."),(0,o.yg)("h3",{id:"step-1-create-a-thing"},"Step 1. Create a Thing"),(0,o.yg)("p",null,"Open your web browser and navigate to ",(0,o.yg)("a",{parentName:"p",href:"https://aws.amazon.com/console/"},"AWS Management Console"),". Sign in using your AWS account credentials."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/1.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"Once you are in the AWS Management Console, locate the ",(0,o.yg)("strong",{parentName:"p"},"Services")," dropdown menu at the top of the page. In the ",(0,o.yg)("strong",{parentName:"p"},"Services")," menu, click on ",(0,o.yg)("strong",{parentName:"p"},"IoT Core"),". If you cannot find it, use the search bar at the top to search for ",(0,o.yg)("strong",{parentName:"p"},"IoT Core"),"."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/2.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"In the AWS IoT Core dashboard, click on ",(0,o.yg)("strong",{parentName:"p"},"All devices")," in the left-side navigation pane to expand the options. Click on ",(0,o.yg)("strong",{parentName:"p"},"Things"),". Click on the ",(0,o.yg)("strong",{parentName:"p"},"Create things"),' button in the corner of the "Things" page.'),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/3.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"Choose ",(0,o.yg)("strong",{parentName:"p"},"Create a single thing")," to proceed with registering one Thing."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/5.png",style:{width:800,height:"auto"}})),(0,o.yg)("p",null,"On the ",(0,o.yg)("strong",{parentName:"p"},"Create a thing")," page, enter ",(0,o.yg)("strong",{parentName:"p"},"XIAO_ESP32C6"),' as the name for your Thing. (Optional) You can also add types, groups, or attributes to your Thing if needed. For a simple setup, you can skip these options. Click "Next".'),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/6.png",style:{width:900,height:"auto"}})),(0,o.yg)("p",null,"You will now be on the ",(0,o.yg)("strong",{parentName:"p"},"Configure device certificate")," page. AWS IoT Core requires devices to use certificates for secure communication. Please select ",(0,o.yg)("strong",{parentName:"p"},"Auto-generate a new certificate (recommended)"),"."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/7.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"On the ",(0,o.yg)("strong",{parentName:"p"},"Attach policies to certificate")," page, if you do not have a policy, you need to create one by clicking on ",(0,o.yg)("strong",{parentName:"p"},"Create policy"),". You'll be taken to a new page where you can create a policy that defines the permissions for your Thing."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/8.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"Once you have created and named your policy, attach it to your newly created certificate by checking the box next to the policy name and clicking ",(0,o.yg)("strong",{parentName:"p"},"Create"),"."),(0,o.yg)("p",null,"We need the following permissions:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"iot:Publish")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"iot:Connect")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"iot:Receive")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"iot:Subscribe"))),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/9.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"After your Thing is registered, you will be redirected to the Thing detail page where you can view your Thing's information."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/10.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"Configure your device (in this case, XIAO_ESP32C6) to use the certificate and private key you downloaded when creating the Thing. You will need to follow the instructions for your specific device to set up the AWS IoT SDK and establish a secure connection to AWS IoT Core."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/11.png",style:{width:600,height:"auto"}})),(0,o.yg)("p",null,"Once your Thing is set up and connected to AWS IoT Core, you can interact with it by subscribing to topics, publishing messages, and using the AWS IoT Core rules engine to process IoT data."),(0,o.yg)("p",null,"Remember to keep your certificates and keys confidential, and follow best practices for security. The AWS IoT Core documentation provides detailed guides and tutorials for setting up and managing IoT devices."),(0,o.yg)("h3",{id:"step-2-preparation-of-headers-based-on-certificates"},"Step 2. Preparation of headers based on certificates"),(0,o.yg)("p",null,"Create a new header file called ",(0,o.yg)("strong",{parentName:"p"},"secrets.h")," and paste the following code template into the header file."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-cpp"},'#include <pgmspace.h>\n\n#define SECRET\n#define THINGNAME "DHTsensor"\n\nconst char WIFI_SSID[] = "YOUR_SSID";              //change this\nconst char WIFI_PASSWORD[] = "YOUR_PASSWORD";           //change this\nconst char AWS_IOT_ENDPOINT[] = "YOUR_AWS_IOT_ENDPOINT";       //change this\n\n// Amazon Root CA 1\nstatic const char AWS_CERT_CA[] PROGMEM = R"EOF(\n-----BEGIN CERTIFICATE-----\n\n-----END CERTIFICATE-----\n)EOF";\n\n// Device Certificate                                               //change this\nstatic const char AWS_CERT_CRT[] PROGMEM = R"KEY(\n-----BEGIN CERTIFICATE-----\n\n-----END CERTIFICATE-----\n\n\n)KEY";\n\n// Device Private Key                                               //change this\nstatic const char AWS_CERT_PRIVATE[] PROGMEM = R"KEY(\n-----BEGIN RSA PRIVATE KEY-----\n\n-----END RSA PRIVATE KEY-----\n\n\n)KEY";\n')),(0,o.yg)("p",null,"This C++ code template is designed for an IoT device that connects to a Wi-Fi network and communicates with the AWS IoT service. The template includes placeholders for various strings that you need to replace with your actual credentials and certificates. Here's how you should fill out each part:"),(0,o.yg)("ol",null,(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},(0,o.yg)("strong",{parentName:"p"},"Wi-Fi Credentials"),":"),(0,o.yg)("ul",{parentName:"li"},(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"WIFI_SSID"),": Replace ",(0,o.yg)("inlineCode",{parentName:"li"},'"YOUR_SSID"')," with the SSID (name) of your Wi-Fi network."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"WIFI_PASSWORD"),": Replace ",(0,o.yg)("inlineCode",{parentName:"li"},'"YOUR_PASSWORD"')," with the password for your Wi-Fi network."))),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},(0,o.yg)("strong",{parentName:"p"},"AWS IoT Endpoint"),":"),(0,o.yg)("ul",{parentName:"li"},(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"AWS_IOT_ENDPOINT"),": Replace ",(0,o.yg)("inlineCode",{parentName:"li"},'"YOUR_AWS_IOT_ENDPOINT"')," with your unique AWS IoT endpoint. This endpoint is specific to your AWS IoT account and region. You can find it in the settings of the AWS IoT console.")))),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/12.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("ol",{start:3},(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},(0,o.yg)("strong",{parentName:"p"},"Amazon Root CA 1 (Certificate Authority)"),":"),(0,o.yg)("ul",{parentName:"li"},(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"AWS_CERT_CA"),": Between the ",(0,o.yg)("inlineCode",{parentName:"li"},"-----BEGIN CERTIFICATE-----")," and ",(0,o.yg)("inlineCode",{parentName:"li"},"-----END CERTIFICATE-----")," markers, paste the entire Amazon Root CA 1 certificate provided by AWS. This certificate allows your device to trust the server's identity."))),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},(0,o.yg)("strong",{parentName:"p"},"Device Certificate"),":"),(0,o.yg)("ul",{parentName:"li"},(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"AWS_CERT_CRT"),": Replace the placeholder between ",(0,o.yg)("inlineCode",{parentName:"li"},"-----BEGIN CERTIFICATE-----")," and ",(0,o.yg)("inlineCode",{parentName:"li"},"-----END CERTIFICATE-----")," with your device's certificate in PEM format. This certificate is unique to your device and is used to authenticate your device with AWS IoT."))),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},(0,o.yg)("strong",{parentName:"p"},"Device Private Key"),":"),(0,o.yg)("ul",{parentName:"li"},(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"AWS_CERT_PRIVATE"),": Between the ",(0,o.yg)("inlineCode",{parentName:"li"},"-----BEGIN RSA PRIVATE KEY-----")," and ",(0,o.yg)("inlineCode",{parentName:"li"},"-----END RSA PRIVATE KEY-----")," markers, paste your device's private key in PEM format. This key must be kept secret and should never be shared as it is used to prove your device's identity when communicating with AWS IoT.")))),(0,o.yg)("admonition",{type:"caution"},(0,o.yg)("p",{parentName:"admonition"},(0,o.yg)("strong",{parentName:"p"},"Amazon Root CA 1")," Corresponds to ",(0,o.yg)("strong",{parentName:"p"},"RSA 2048 bit key:Amazon Root CA 1")," downloaded file information.\n",(0,o.yg)("strong",{parentName:"p"},"Device Certificate")," Corresponds to the ",(0,o.yg)("strong",{parentName:"p"},"Device certificate")," downloaded file information.\n",(0,o.yg)("strong",{parentName:"p"},"Device Private Key")," Corresponds to the ",(0,o.yg)("strong",{parentName:"p"},"Private key file")," downloaded file information."),(0,o.yg)("p",{parentName:"admonition"},"Since this code contains sensitive information, such as Wi-Fi credentials and private keys, it is crucial to keep it secure. Do not share the modified code publicly or commit it to public repositories.")),(0,o.yg)("h3",{id:"step-3-upload-data-acquisition-programme-for-xiao-esp32c6"},"Step 3. Upload data acquisition programme for XIAO ESP32C6"),(0,o.yg)("p",null,"Please connect the Grove DHT20 sensor to the IIC interface of the XIAO ESP32C6. If you want convenience, we recommend you to buy ",(0,o.yg)("a",{parentName:"p",href:"https://www.seeedstudio.com/Grove-Shield-for-Seeeduino-XIAO-p-4621.html"},"Grove Base for XIAO"),"."),(0,o.yg)("p",null,"Then, please create a new project in Arduino and save it locally. Take the ",(0,o.yg)("strong",{parentName:"p"},"secrets.h")," file we created in ",(0,o.yg)("strong",{parentName:"p"},"Step 2")," and copy it to the same directory as the .ino file. Then, please upload the code below to XIAO ESP32C6 and the data will be sent to the specified topic via MQTT based on the AWS credentials you provided."),(0,o.yg)("details",null,(0,o.yg)("summary",null,"Click here to preview the full code"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-cpp"},'#include "secrets.h"\n#include <WiFiClientSecure.h>\n#include <PubSubClient.h>\n#include <ArduinoJson.h>\n#include "WiFi.h"\n#include "Wire.h"\n\n//DHT setup\n#include "DHT.h"\n#define DHTTYPE DHT20   // DHT 20\n/*Notice: The DHT10 and DHT20 is different from other DHT* sensor ,it uses i2c interface rather than one wire*/\n/*So it doesn\'t require a pin.*/\nDHT dht(DHTTYPE);         //   DHT10 DHT20 don\'t need to define Pin\n\n//MQTT setup\n#define AWS_IOT_PUBLISH_TOPIC   "xiao_esp32c6/pub"\n#define AWS_IOT_SUBSCRIBE_TOPIC "xiao_esp32c6/sub"\n\n//store temp and humi data\nfloat h;\nfloat t;\n\n//network setup\nWiFiClientSecure net = WiFiClientSecure();\nPubSubClient client(net);\n\n#if defined(ARDUINO_ARCH_AVR)\n    #define debug  Serial\n\n#elif defined(ARDUINO_ARCH_SAMD) ||  defined(ARDUINO_ARCH_SAM)\n    #define debug  SerialUSB\n#else\n    #define debug  Serial\n#endif\n\nvoid connectAWS()\n{\n  WiFi.mode(WIFI_STA);\n  WiFi.begin(WIFI_SSID, WIFI_PASSWORD);\n \n  Serial.println("Connecting to Wi-Fi");\n \n  while (WiFi.status() != WL_CONNECTED)\n  {\n    delay(500);\n    Serial.print(".");\n  }\n \n  // Configure WiFiClientSecure to use the AWS IoT device credentials\n  net.setCACert(AWS_CERT_CA);\n  net.setCertificate(AWS_CERT_CRT);\n  net.setPrivateKey(AWS_CERT_PRIVATE);\n \n  // Connect to the MQTT broker on the AWS endpoint we defined earlier\n  client.setServer(AWS_IOT_ENDPOINT, 8883);\n \n  // Create a message handler\n  client.setCallback(messageHandler);\n \n  Serial.println("Connecting to AWS IOT");\n \n  while (!client.connect(THINGNAME))\n  {\n    Serial.print(".");\n    delay(100);\n  }\n \n  if (!client.connected())\n  {\n    Serial.println("AWS IoT Timeout!");\n    return;\n  }\n \n  // Subscribe to a topic\n  client.subscribe(AWS_IOT_SUBSCRIBE_TOPIC);\n \n  Serial.println("AWS IoT Connected!");\n}\n\nvoid publishMessage()\n{\n  StaticJsonDocument<200> doc;\n  doc["humidity"] = h;\n  doc["temperature"] = t;\n  char jsonBuffer[512];\n  serializeJson(doc, jsonBuffer); // print to client\n \n  client.publish(AWS_IOT_PUBLISH_TOPIC, jsonBuffer);\n}\n \nvoid messageHandler(char* topic, byte* payload, unsigned int length)\n{\n  Serial.print("incoming: ");\n  Serial.println(topic);\n \n  StaticJsonDocument<200> doc;\n  deserializeJson(doc, payload);\n  const char* message = doc["message"];\n  Serial.println(message);\n}\n\nvoid setup() {\n\n    debug.begin(115200);\n    debug.println("DHTxx test!");\n    Wire.begin();\n\n    connectAWS();\n    dht.begin();\n}\n\nvoid loop() {\n    h = dht.readHumidity();\n    t = dht.readTemperature();\n\n    if (isnan(h) || isnan(t) )  // Check if any reads failed and exit early (to try again).\n    {\n      Serial.println(F("Failed to read from DHT sensor!"));\n      return;\n    }\n  \n    Serial.print(F("Humidity: "));\n    Serial.print(h);\n    Serial.print(F("%  Temperature: "));\n    Serial.print(t);\n    Serial.println(F("\xb0C "));\n  \n    publishMessage();\n    client.loop();\n    delay(1000);\n}\n'))),(0,o.yg)("h3",{id:"step-4-mqtt-test-client"},"Step 4. MQTT test client"),(0,o.yg)("p",null,"In AWS IoT Core, we need to subscribe to the XIAO ESP32C6 published topic in the MQTT test client in order to determine, if the sensor's data is successfully uploaded to the target AWS account."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/13.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"If the programme is working properly, you should see a set of data messages for temperature and humidity every 1s."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-json"},'{\n    "humidity": 58,\n    "temperature": 23.6\n}\n')),(0,o.yg)("h2",{id:"store-the-data-using-aws-analytics"},"Store the data using AWS Analytics"),(0,o.yg)("p",null,"The gathered data is then forwarded to the AWS Analytics service, which not only stores the raw data but also provides us with powerful data processing and analysis tools. These tools assist us in extracting valuable insights from the collected data."),(0,o.yg)("h3",{id:"step-5-configure-aws-iot-analytics"},"Step 5. Configure AWS IoT Analytics"),(0,o.yg)("p",null,"Navigate to AWS IoT Analytics in the AWS Console."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/14.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"In ",(0,o.yg)("strong",{parentName:"p"},"Get started with AWS IoT Analytics"),", fill in the name of the newly created resource and enter your subscription subject.(e.g., ",(0,o.yg)("inlineCode",{parentName:"p"},"xiao_esp32c6/pub"),")."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/15.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"Wait a moment (ten minutes or so) for all resources to be created."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/16.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("h3",{id:"step-6-create-a-rule"},"Step 6. Create a rule"),(0,o.yg)("p",null,"Back in AWS IoT Core, click ",(0,o.yg)("strong",{parentName:"p"},"Rules")," under ",(0,o.yg)("strong",{parentName:"p"},"Message routing")," in the left menu bar. Click ",(0,o.yg)("strong",{parentName:"p"},"Create rule"),"."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/17.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"Provide a name for your Rule and an optional description to help identify its purpose."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/18.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"Define the Rule Query Statement using the AWS IoT SQL syntax. This statement specifies the criteria for filtering and processing the incoming MQTT messages. You can use wildcards, functions, and operators to match specific topics, extract data from the message payload, and apply transformations."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/19.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"Select the IoT Analytics channel you created as the target for the Rule Action. Click on the ",(0,o.yg)("strong",{parentName:"p"},"Create Role")," button. In the console, provide a name for the role, such as ",(0,o.yg)("strong",{parentName:"p"},"XIAO_ESP32C6_Role"),"."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/20.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/21.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,'Review your Rule configuration and click on the "Create Rule" button to save and activate the Rule.'),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/22.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"Once the Rule is created, it starts processing incoming MQTT messages that match the defined Rule Query Statement. The Rule Actions are executed whenever the Rule is triggered, allowing you to route and process the data according to your specific requirements."),(0,o.yg)("p",null,"You can create multiple Rules in AWS IoT to handle different scenarios and data processing needs. Rules provide a flexible and scalable way to integrate your IoT devices with various AWS services and build powerful IoT applications."),(0,o.yg)("h3",{id:"step-7-stores-sensor-data-streams"},"Step 7. Stores sensor data streams"),(0,o.yg)("p",null,"Navigate to the AWS IoT Analytics service. In the AWS IoT Analytics dashboard, click on the ",(0,o.yg)("strong",{parentName:"p"},"Datasets")," option in the left sidebar. Locate the dataset that contains the data you want to download and click on its name to open the dataset details page."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/25.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"Before downloading the dataset content, you need to manually trigger the dataset generation. Select ",(0,o.yg)("strong",{parentName:"p"},"Run now"),"."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/26.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"AWS IoT Analytics will process the data and prepare the dataset content based on the specified time range. Based on reporting sensor data once per second, we recommend a data collection time of at least greater than or equal to one hour in a normal environment. This ensures the accuracy of the data."),(0,o.yg)("p",null,'Wait for the dataset generation to complete. You can monitor the progress in the dataset details page. Once the status changes to "SUCCEEDED", the dataset content is ready for download.'),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/28.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/23.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("admonition",{type:"tip"},(0,o.yg)("p",{parentName:"admonition"},"If XIAO's programme works fine, but you don't see any data information in Dataset, you can right mouse click on Dataset's tab and open it in a new browser page, this may solve your problem."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/27.png",style:{width:500,height:"auto"}})),(0,o.yg)("p",{parentName:"admonition"},"In the dataset details page, you will see information about the dataset, including its name, status, and the last update time."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/24.png",style:{width:1e3,height:"auto"}}))),(0,o.yg)("h2",{id:"use-aws-sagemaker-to-train-data-in-normal-environments"},"Use AWS Sagemaker to train data in normal environments"),(0,o.yg)("p",null,"With AWS Sagemaker, we train machine learning models to recognize patterns indicative of a normal environment. Sagemaker offers a comprehensive platform that facilitates the development, training, and deployment of machine learning models, enabling intelligent processing of environmental data."),(0,o.yg)("h3",{id:"step-8-create-a-new-notebook-instance"},"Step 8. Create a new notebook instance"),(0,o.yg)("p",null,"Navigate to the Amazon SageMaker service in the AWS Management Console."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/29.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"Click on ",(0,o.yg)("strong",{parentName:"p"},"Notebook instances")," in the SageMaker dashboard. Click the ",(0,o.yg)("strong",{parentName:"p"},"Create notebook instance")," button."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/30.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"Fill in the necessary information such as instance type and IAM role. Make sure the IAM role has ",(0,o.yg)("strong",{parentName:"p"},"necessary permissions to access the S3 bucket")," where your data is stored."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/34.png",style:{width:600,height:"auto"}})),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/31.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"Once the instance status is ",(0,o.yg)("strong",{parentName:"p"},"InService"),", open the Jupyter notebook interface by clicking the ",(0,o.yg)("strong",{parentName:"p"},"Open Jupyter")," link."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/32.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"Once opened, we select ",(0,o.yg)("strong",{parentName:"p"},"conda_python3")," as our code environment."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/45.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"Then, we need to upload our collected dataset. This dataset we have downloaded locally to our computer in ",(0,o.yg)("strong",{parentName:"p"},"Step 7"),"."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/46.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"Then, we can enter our prepared program inside Jupyter Notebook. Or you can choose to directly upload the program we provided."),(0,o.yg)("div",{class:"github_container",style:{textAlign:"center"}},(0,o.yg)("a",{class:"github_item",href:"https://github.com/Seeed-Projects/XIAO_ESP32C6_AWS_DHT20_Project/blob/main/TrainingModel/Jupyter_Notebook.ipynb"},(0,o.yg)("strong",null,(0,o.yg)("span",null,(0,o.yg)("font",{color:"FFFFFF",size:"4"},"Download the Code")))," ",(0,o.yg)("svg",{"aria-hidden":"true",focusable:"false",role:"img",className:"mr-2",viewBox:"-3 10 9 1",width:16,height:16,fill:"currentColor",style:{textAlign:"center",display:"inline-block",userSelect:"none",verticalAlign:"text-bottom",overflow:"visible"}},(0,o.yg)("path",{d:"M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z"})))),(0,o.yg)("br",null),(0,o.yg)("p",null,"Run the first section of the programme to check that the collection data you have imported is OK. You may need to change the name of the file in the code to your filename."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/47.png",style:{width:600,height:"auto"}})),(0,o.yg)("h3",{id:"step-9-run-all-jupyter-notebook"},"Step 9: Run all Jupyter Notebook"),(0,o.yg)("p",null,"S3 is used to store training datasets, test datasets, model artifacts, etc. In SageMaker, data sources typically come from S3 buckets.\nModel saving: Trained models are also saved in S3 for subsequent deployment and inference."),(0,o.yg)("p",null,"Then, please copy the second code block and name the field ",(0,o.yg)("strong",{parentName:"p"},"bucket_name"),"."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/48.png",style:{width:600,height:"auto"}})),(0,o.yg)("p",null,"Then, just run the blocks in Jupyter Notebook one by one."),(0,o.yg)("admonition",{type:"note"},(0,o.yg)("p",{parentName:"admonition"},"There are some paths or names in Jupyter Notebook that need to be modified as follows before they can be run."),(0,o.yg)("ol",{parentName:"admonition"},(0,o.yg)("li",{parentName:"ol"},"The value of ",(0,o.yg)("strong",{parentName:"li"},"ENDPOINT_NAME")," in the ",(0,o.yg)("strong",{parentName:"li"},"In","[22]")," code block is the result after running the ",(0,o.yg)("strong",{parentName:"li"},"In","[19]")," code block."),(0,o.yg)("li",{parentName:"ol"},"Please set the ",(0,o.yg)("strong",{parentName:"li"},"bucket_name")," of ",(0,o.yg)("strong",{parentName:"li"},"In","[3]")," and ",(0,o.yg)("strong",{parentName:"li"},"In","[10]")," code blocks to the same name."),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("strong",{parentName:"li"},"API_ENDPOINT")," for the last code block, use your own values."))),(0,o.yg)("h3",{id:"step-10-configure-aws-lambda"},"Step 10. Configure AWS Lambda"),(0,o.yg)("p",null,"Lambda can be used as a trigger for SageMaker workflows. For example, when data is uploaded to S3, it can trigger a Lambda function to start a SageMaker training or processing job."),(0,o.yg)("p",null,"Sign in to the AWS Management Console and navigate to the AWS Lambda service."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/37.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"Click on the ",(0,o.yg)("strong",{parentName:"p"},"Create function")," button."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/38.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"Choose the ",(0,o.yg)("strong",{parentName:"p"},"Author from scratch")," option. Provide a name for your Lambda function, e.g., ",(0,o.yg)("strong",{parentName:"p"},"XIAO-ESP32C6-FUNCTION"),".\nSelect the desired runtime ",(0,o.yg)("strong",{parentName:"p"},"Python3.9"),". Choose an execution role for your Lambda function. You can either create a new role or use an existing one. If creating a new role, select ",(0,o.yg)("strong",{parentName:"p"},"Create a new role with basic Lambda permissions"),". Click on the ",(0,o.yg)("strong",{parentName:"p"},"Create function")," button to create your Lambda function."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/39.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"Navigate to the IAM (Identity and Access Management) console."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/40.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"Then find the name of the Lambda Function we just created and click on it."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/41.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"In the IAM role page, click on the ",(0,o.yg)("strong",{parentName:"p"},"Attach policies")," button."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/42.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"Provide a name for the policy, e.g., ",(0,o.yg)("strong",{parentName:"p"},"AmazonSageMakerFullAccess"),". Click on the ",(0,o.yg)("strong",{parentName:"p"},"Add perminassions")," button to add perminassions."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/43.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"Go back to the Lambda function configuration page. Create a new test event or use an existing one. Invoke the Lambda function with the test event to ensure it runs successfully. Monitor the Lambda function's execution logs and outputs to verify its behavior."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre"},'{"data": [62.93016434, 24.31583405]}\n')),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/44.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"Copy ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/Seeed-Projects/XIAO_ESP32C6_AWS_DHT20_Project/blob/main/TrainingModel/Lambda.ipynb"},"the following snippet")," into ",(0,o.yg)("strong",{parentName:"p"},"Code"),"."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-python"},"#lambda function with sns\nimport boto3\nimport json\n\nENDPOINT_NAME = 'randomcutforest-2024-03-18-10-47-37-165'# your endpoint past here\nruntime = boto3.client('runtime.sagemaker')\nemail_client = boto3.client('sns')\n\ndef lambda_handler(event, context):\n    input = event['data']\n    \n    serialized_input = ','.join(map(str, input))\n\n    response = runtime.invoke_endpoint(EndpointName=ENDPOINT_NAME, \n                                       ContentType='text/csv', \n                                       Body=serialized_input)\n\n    result_str = response['Body'].read().decode()\n    result_json = json.loads(result_str)\n    inference = result_json['scores'][0]['score']\n    \n    try:\n        if(inference>3):\n            response_sns = email_client.publish(\n                TopicArn='arn:aws:sns:us-east-1:381491976713:dhco2Topic2',# your sns topic past here\n                Message='Enviroment data is abnormal',\n                Subject='Enviroment Status'\n            )\n    except Exception as e:\n        print(f\"error: {e}\")\n\n    return inference\n")),(0,o.yg)("admonition",{type:"caution"},(0,o.yg)("p",{parentName:"admonition"},"Please take care to modify the content in the code to be your own.")),(0,o.yg)("p",null,"Then click the ",(0,o.yg)("strong",{parentName:"p"},"Deploy")," button."),(0,o.yg)("h3",{id:"additional-considerations"},"Additional Considerations"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"Ensure that you have the correct IAM roles and policies in place for SageMaker to access the data in S3."),(0,o.yg)("li",{parentName:"ul"},"Consider using SageMaker's Automatic Model Tuning to find the best version of your model."),(0,o.yg)("li",{parentName:"ul"},"Keep track of costs, as training models and deploying endpoints on SageMaker can incur significant charges depending on the compute resources used.")),(0,o.yg)("p",null,"Always consult the latest AWS documentation for detailed instructions and best practices, as the interface and functionalities of AWS services are frequently updated."),(0,o.yg)("h2",{id:"abnormal-status-message-notification"},"Abnormal status message notification"),(0,o.yg)("p",null,"Upon detection of an abnormal state, the system immediately sends out an alert through a messaging notification mechanism to maintenance personnel, ensuring timely intervention and necessary action."),(0,o.yg)("h3",{id:"step-11-configuring-amazon-sns"},"Step 11. Configuring Amazon SNS"),(0,o.yg)("p",null,"Navigate to the Amazon SNS service."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/49.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"Click on the ",(0,o.yg)("strong",{parentName:"p"},"Create topic"),' button. Provide a name for your topic, e.g., "XIAO_ESP32C6_Topic".'),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/50.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"In the SNS topic dashboard, click on the newly created topic. Click on the ",(0,o.yg)("strong",{parentName:"p"},"Create subscription")," button."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/51.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,'Choose the protocol for the subscription, such as "Email", "SMS", "HTTP/HTTPS", "AWS Lambda", or "Amazon SQS".'),(0,o.yg)("p",null,"Provide the endpoint details based on the selected protocol. For example:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"For email subscriptions, enter the email address."),(0,o.yg)("li",{parentName:"ul"},"For SMS subscriptions, enter the phone number."),(0,o.yg)("li",{parentName:"ul"},"For HTTP/HTTPS subscriptions, enter the URL endpoint."),(0,o.yg)("li",{parentName:"ul"},"For AWS Lambda subscriptions, select the Lambda function."),(0,o.yg)("li",{parentName:"ul"},"For Amazon SQS subscriptions, select the SQS queue.")),(0,o.yg)("p",null,"Click on the ",(0,o.yg)("strong",{parentName:"p"},"Create subscription")," button to create the subscription. Repeat steps 2-5 to add more subscriptions to the topic if needed."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/52.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"Then we go back to the Lambda's code and replace the ",(0,o.yg)("strong",{parentName:"p"},"TopicArn")," field in the code with the ",(0,o.yg)("strong",{parentName:"p"},"ARN field in the SNS"),"."),(0,o.yg)("h3",{id:"step-12-give-sns-permissions-to-lambda"},"Step 12. Give SNS permissions to Lambda"),(0,o.yg)("p",null,"Navigate to the IAM (Identity and Access Management) console."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/40.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"Then find the name of the Lambda Function we just created and click on it."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/41.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"In the IAM role page, click on the ",(0,o.yg)("strong",{parentName:"p"},"Attach policies")," button."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/42.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"Provide a name for the policy, e.g., ",(0,o.yg)("strong",{parentName:"p"},"AmazonSNSFullAccess"),". Click on the ",(0,o.yg)("strong",{parentName:"p"},"Add perminassions")," button to add perminassions."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/53.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("h3",{id:"step-13-configuring-api-gateway"},"Step 13. Configuring API Gateway"),(0,o.yg)("p",null,"Navigate to the Amazon API Gateway service in the AWS Management Console."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/54.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"Click on the ",(0,o.yg)("strong",{parentName:"p"},"Create API")," button."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/55.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"Select ",(0,o.yg)("strong",{parentName:"p"},"REST API")," as the API type and click on ",(0,o.yg)("strong",{parentName:"p"},"Build"),"."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/56.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,'Provide a name for your API, e.g., "XIAO_ESP32C6_API". Choose the ',(0,o.yg)("strong",{parentName:"p"},"Regional")," endpoint type for your API. Click on the ",(0,o.yg)("strong",{parentName:"p"},"Create API")," button to create your REST API."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/57.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"In the API Gateway dashboard, select your newly created API. Select ",(0,o.yg)("strong",{parentName:"p"},"Create Resource"),"."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/58.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,'Provide a name for your resource, e.g., "XIAO_ESP32C6_Resource". Click on the ',(0,o.yg)("strong",{parentName:"p"},"Create Resource")," button to create the resource."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/59.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"With the newly created resource selected, Select ",(0,o.yg)("strong",{parentName:"p"},"Create Method"),"."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/60.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"Choose ",(0,o.yg)("strong",{parentName:"p"},"POST")," as the HTTP method from the dropdown list. Select ",(0,o.yg)("strong",{parentName:"p"},"Lambda Function"),' as the integration type. Choose the region where your Lambda function is located. Enter the name of your Lambda function, e.g., "XIAO_ESP32C6_Function".\nClick on the ',(0,o.yg)("strong",{parentName:"p"},"Create method")," button to save the integration settings."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/61.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"Click on the ",(0,o.yg)("strong",{parentName:"p"},"Deploy API"),'. Choose a deployment stage (e.g., "prod", "dev") or create a new one. Provide a description for the deployment if desired. Click on the "Deploy" button to deploy your API.'),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/63.png",style:{width:500,height:"auto"}})),(0,o.yg)("p",null,'In the API Gateway dashboard, select your API and navigate to the "Stages" section. Expand the deployment stage and click on the POST method for your resource. In the ',(0,o.yg)("strong",{parentName:"p"},"Invoke URL")," section, copy the provided URL."),(0,o.yg)("div",{style:{textAlign:"center"}},(0,o.yg)("img",{src:"https://files.seeedstudio.com/wiki/xiao-esp32c6-aws/64.png",style:{width:1e3,height:"auto"}})),(0,o.yg)("p",null,"Finally, copy and paste the ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/Seeed-Projects/XIAO_ESP32C6_AWS_DHT20_Project/blob/main/TrainingModel/api_gateway.ipynb"},"api_gateway code")," to the end of the SageMaker Jupyter Notebook (create a new snippet) and replace the ",(0,o.yg)("strong",{parentName:"p"},"API_ENDPOINT")," field in the code with the ",(0,o.yg)("strong",{parentName:"p"},"Invoke URL"),"."),(0,o.yg)("h2",{id:"xiao-esp32c6-for-abnormal-environment-detection"},"XIAO ESP32C6 for abnormal environment detection"),(0,o.yg)("p",null,"Once a data model of the normal environment is established, the XIAO ESP32C6 continuously monitors the sensor data to detect any potential anomalies. As a powerful microcontroller, it is capable of rapidly responding when data indicates an abnormal situation."),(0,o.yg)("h3",{id:"step-14-upload-real-time-data-reporting-program-for-xiao-esp32c6"},"Step 14. Upload real-time data reporting program for XIAO ESP32C6"),(0,o.yg)("div",{class:"github_container",style:{textAlign:"center"}},(0,o.yg)("a",{class:"github_item",href:"https://github.com/Seeed-Projects/XIAO_ESP32C6_AWS_DHT20_Project/blob/main/GetResult/GetResult.ino"},(0,o.yg)("strong",null,(0,o.yg)("span",null,(0,o.yg)("font",{color:"FFFFFF",size:"4"},"Download the Code")))," ",(0,o.yg)("svg",{"aria-hidden":"true",focusable:"false",role:"img",className:"mr-2",viewBox:"-3 10 9 1",width:16,height:16,fill:"currentColor",style:{textAlign:"center",display:"inline-block",userSelect:"none",verticalAlign:"text-bottom",overflow:"visible"}},(0,o.yg)("path",{d:"M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z"})))),(0,o.yg)("br",null),(0,o.yg)("p",null,"Get the programme from below and replace the api field in the code with yours. Then compile and upload it to XIAO ESP32C6. Then congratulations, the steps have been carried out to this point, you have successfully completed the entire project steps. As soon as there is an anomaly in the environment, you will get a warning email notification sent to you by the AWS SNS service."),(0,o.yg)("h2",{id:"tech-support--product-discussion"},"Tech Support & Product Discussion"),(0,o.yg)("p",null,"Thank you for choosing our products! We are here to provide you with different support to ensure that your experience with our products is as smooth as possible. We offer several communication channels to cater to different preferences and needs."),(0,o.yg)("div",{class:"table-center"},(0,o.yg)("div",{class:"button_tech_support_container"},(0,o.yg)("a",{href:"https://forum.seeedstudio.com/",class:"button_forum"}),(0,o.yg)("a",{href:"https://www.seeedstudio.com/contacts",class:"button_email"})),(0,o.yg)("div",{class:"button_tech_support_container"},(0,o.yg)("a",{href:"https://discord.gg/eWkprNDMU7",class:"button_discord"}),(0,o.yg)("a",{href:"https://github.com/Seeed-Studio/wiki-documents/discussions/69",class:"button_discussion"}))))}d.isMDXComponent=!0}}]);