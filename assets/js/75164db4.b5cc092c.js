"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[76484],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var i=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=i.createContext({}),p=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=p(e.components);return i.createElement(s.Provider,{value:t},e.children)},u="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},c=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=p(n),c=a,m=u["".concat(s,".").concat(c)]||u[c]||h[c]||o;return n?i.createElement(m,r(r({ref:t},d),{},{components:n})):i.createElement(m,r({ref:t},d))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,r=new Array(o);r[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[u]="string"==typeof e?e:a,r[1]=l;for(var p=2;p<o;p++)r[p]=n[p];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}c.displayName="MDXCreateElement"},92120:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var i=n(87462),a=(n(67294),n(3905));const o={description:"XIAO ESP32C3 with Zephyr(RTOS)",title:"XIAO ESP32C3 with Zephyr(RTOS)",keywords:["Sorftware"],image:"https://files.seeedstudio.com/wiki/wiki-platform/S-tempor.png",slug:"/XIAO-ESP32C3-Zephyr",last_update:{date:"4/17/2023",author:"timo614"}},r="XIAO ESP32C3 with Zephyr(RTOS)",l={unversionedId:"Sensor/SeeedStudio_XIAO/SeeedStudio_XIAO_ESP32C3/XIAO-ESP32C3-Zephyr",id:"Sensor/SeeedStudio_XIAO/SeeedStudio_XIAO_ESP32C3/XIAO-ESP32C3-Zephyr",title:"XIAO ESP32C3 with Zephyr(RTOS)",description:"XIAO ESP32C3 with Zephyr(RTOS)",source:"@site/docs/Sensor/SeeedStudio_XIAO/SeeedStudio_XIAO_ESP32C3/XIAO-ESP32C3-Zephyr.md",sourceDirName:"Sensor/SeeedStudio_XIAO/SeeedStudio_XIAO_ESP32C3",slug:"/XIAO-ESP32C3-Zephyr",permalink:"/XIAO-ESP32C3-Zephyr",draft:!1,editUrl:"https://github.com/Seeed-Studio/wiki-documents/blob/docusaurus-version/docs/Sensor/SeeedStudio_XIAO/SeeedStudio_XIAO_ESP32C3/XIAO-ESP32C3-Zephyr.md",tags:[],version:"current",lastUpdatedBy:"timo614",lastUpdatedAt:1681689600,formattedLastUpdatedAt:"Apr 17, 2023",frontMatter:{description:"XIAO ESP32C3 with Zephyr(RTOS)",title:"XIAO ESP32C3 with Zephyr(RTOS)",keywords:["Sorftware"],image:"https://files.seeedstudio.com/wiki/wiki-platform/S-tempor.png",slug:"/XIAO-ESP32C3-Zephyr",last_update:{date:"4/17/2023",author:"timo614"}},sidebar:"ProductSidebar",previous:{title:"MicroPython for ESP32C3",permalink:"/XIAO_ESP32C3_MicroPython"},next:{title:"WiFi Usage",permalink:"/XIAO_ESP32C3_WiFi_Usage"}},s={},p=[{value:"What is RTOS",id:"what-is-rtos",level:2},{value:"What is Zephyr",id:"what-is-zephyr",level:2},{value:"Feature",id:"feature",level:2},{value:"Extensive suite of Kernel services",id:"extensive-suite-of-kernel-services",level:3},{value:"Multiple Scheduling Algorithms",id:"multiple-scheduling-algorithms",level:3},{value:"Bluetooth Low Energy 5.0 support",id:"bluetooth-low-energy-50-support",level:3},{value:"Getting Started",id:"getting-started",level:2},{value:"Hardware Preparation",id:"hardware-preparation",level:2},{value:"Developer Knowledge",id:"developer-knowledge",level:3},{value:"XIAO Expansion Board",id:"xiao-expansion-board",level:4},{value:"Pin Definitions",id:"pin-definitions",level:4},{value:"Primary Functionality",id:"primary-functionality",level:3},{value:"GPIO / LED Enable",id:"gpio--led-enable",level:4},{value:"Bluetooth",id:"bluetooth",level:4},{value:"Wi-Fi",id:"wi-fi",level:4},{value:"TFLite - Hello World",id:"tflite---hello-world",level:4},{value:"Additional Components",id:"additional-components",level:3},{value:"Grove - Expansion Board - I2C Display",id:"grove---expansion-board---i2c-display",level:4},{value:"Grove - Expansion Board - Button",id:"grove---expansion-board---button",level:4},{value:"Grove - Expansion Board - Buzzer",id:"grove---expansion-board---buzzer",level:4},{value:"Grove - Expansion Board - SD Card",id:"grove---expansion-board---sd-card",level:4},{value:"Grove - Temperature and Humidity Sensor (SHT31)",id:"grove---temperature-and-humidity-sensor-sht31",level:4},{value:"1.69inch LCD Display Module, 240\xd7280 Resolution, SPI Interface",id:"169inch-lcd-display-module-240280-resolution-spi-interface",level:4},{value:"\u2728 Contributor Project",id:"-contributor-project",level:2},{value:"Tech Support &amp; Product Discussion",id:"tech-support--product-discussion",level:2}],d={toc:p},u="wrapper";function h(e){let{components:t,...n}=e;return(0,a.kt)(u,(0,i.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"xiao-esp32c3-with-zephyrrtos"},"XIAO ESP32C3 with Zephyr(RTOS)"),(0,a.kt)("div",{align:"center"},(0,a.kt)("img",{width:"{600}",src:"https://files.seeedstudio.com/wiki/xiao_topicpage/zephyr-esp32c3.png"})),(0,a.kt)("h2",{id:"what-is-rtos"},"What is RTOS"),(0,a.kt)("p",null,"One of the most important components of today's embedded systems is the ",(0,a.kt)("strong",{parentName:"p"},"RTOS")," also known as ",(0,a.kt)("strong",{parentName:"p"},"Real-Time Operating System"),", which is responsible for everything from task scheduling to performing applications."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"RTOS")," is designed to provide a predictable execution mode. When the processing must meet the time limit of the system, RTOS is used. Therefore, compared with GPOS (General Purpose Operating System), RTOS is usually light in weight and small in size, and generally only provides functions required to run specific types of applications on specific hardware. In some cases, developers can modify the existing RTOS, narrow it down to only provide the functionality required by a specific application, and/or customize its functionality or performance characteristics."),(0,a.kt)("h2",{id:"what-is-zephyr"},"What is ",(0,a.kt)("a",{parentName:"h2",href:"https://www.zephyrproject.org/"},"Zephyr")),(0,a.kt)("div",{align:"center"},(0,a.kt)("img",{width:"{200}",src:"https://files.seeedstudio.com/wiki/XIAO/Zephyr_logo.png"})),(0,a.kt)("p",null,"The ",(0,a.kt)("a",{parentName:"p",href:"https://www.zephyrproject.org/"},(0,a.kt)("strong",{parentName:"a"},"Zephyr"))," OS is based on a small-footprint kernel designed for use on resource-constrained and embedded systems: from simple embedded environmental sensors and LED wearables to sophisticated embedded controllers, smart watches, and IoT wireless applications."),(0,a.kt)("h2",{id:"feature"},"Feature"),(0,a.kt)("p",null,"Zephyr offers a large and ever growing number of features including:"),(0,a.kt)("h3",{id:"extensive-suite-of-kernel-services"},"Extensive suite of Kernel services"),(0,a.kt)("p",null,"Zephyr offers a number of familiar services for development:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("em",{parentName:"li"},"Multi-threading Services")," for cooperative, priority-based, non-preemptive, and preemptive threads with optional round robin time-slicing. Includes POSIX pthreads compatible API support."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("em",{parentName:"li"},"Interrupt Services")," for compile-time registration of interrupt handlers."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("em",{parentName:"li"},"Memory Allocation Services")," for dynamic allocation and freeing of fixed-size or variable-size memory blocks."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("em",{parentName:"li"},"Inter-thread Synchronization Services")," for binary semaphores, counting semaphores, and mutex semaphores."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("em",{parentName:"li"},"Inter-thread Data Passing Services")," for basic message queues, enhanced message queues, and byte streams."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("em",{parentName:"li"},"Power Management Services")," such as overarching, application or policy-defined, System Power Management and fine-grained, driver-defined, Device Power Management.")),(0,a.kt)("h3",{id:"multiple-scheduling-algorithms"},"Multiple Scheduling Algorithms"),(0,a.kt)("p",null,"  Zephyr provides a comprehensive set of thread scheduling choices:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Cooperative and Preemptive Scheduling"),(0,a.kt)("li",{parentName:"ul"},"Earliest Deadline First (EDF)"),(0,a.kt)("li",{parentName:"ul"},"Meta IRQ scheduling implementing \u201cinterrupt bottom half\u201d or \u201ctasklet\u201d behavior"),(0,a.kt)("li",{parentName:"ul"},"Timeslicing: Enables time slicing between preemptible threads of equal priority"),(0,a.kt)("li",{parentName:"ul"},"Multiple queuing strategies:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Simple linked-list ready queue"),(0,a.kt)("li",{parentName:"ul"},"Red/black tree ready queue"),(0,a.kt)("li",{parentName:"ul"},"Traditional multi-queue ready queue")))),(0,a.kt)("h3",{id:"bluetooth-low-energy-50-support"},"Bluetooth Low Energy 5.0 support"),(0,a.kt)("p",null,"Bluetooth 5.0 compliant (ESR10) and Bluetooth Low Energy Controller support (LE Link Layer). Includes Bluetooth mesh and a Bluetooth qualification-ready Bluetooth controller."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Generic Access Profile (GAP) with all possible LE roles"),(0,a.kt)("li",{parentName:"ul"},"Generic Attribute Profile (GATT)"),(0,a.kt)("li",{parentName:"ul"},"Pairing support, including the Secure Connections feature from Bluetooth 4.2"),(0,a.kt)("li",{parentName:"ul"},"Clean HCI driver abstraction"),(0,a.kt)("li",{parentName:"ul"},"Raw HCI interface to run Zephyr as a Controller instead of a full Host stack"),(0,a.kt)("li",{parentName:"ul"},"Verified with multiple popular controllers"),(0,a.kt)("li",{parentName:"ul"},"Highly configurable")),(0,a.kt)("p",null,"Mesh Support:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Relay, Friend Node, Low-Power Node (LPN) and GATT Proxy features"),(0,a.kt)("li",{parentName:"ul"},"Both Provisioning bearers supported (PB-ADV & PB-GATT)"),(0,a.kt)("li",{parentName:"ul"},"Highly configurable, fitting in devices with at least 16k RAM")),(0,a.kt)("p",null,(0,a.kt)("em",{parentName:"p"},"Reference: ",(0,a.kt)("a",{parentName:"em",href:"https://docs.zephyrproject.org/latest/introduction/index.html#"},(0,a.kt)("strong",{parentName:"a"},"Zephyr Project")))),(0,a.kt)("h2",{id:"getting-started"},"Getting Started"),(0,a.kt)("p",null,"The first step to working with Zephyr is to get the SDK and toolchain setup for local development. The ",(0,a.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/develop/getting_started/index.html"},"Zephyr getting started guide")," should be referenced for the associated setup procedure needed for your environment."),(0,a.kt)("p",null,"Once the Zephyr toolchain has been setup and an associated SDK has been downloaded you can begin application development."),(0,a.kt)("p",null,"For the Xiao ESP32C3 the ",(0,a.kt)("a",{parentName:"p",href:"https://docs.zephyrproject.org/latest/boards/seeed/xiao_esp32c3/doc/index.html"},"board description file")," can be referenced for further setup information."),(0,a.kt)("p",null,"To fetch the blobs needed for using the ESP32C3 run the following command:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"west blobs fetch hal_espressif\n")),(0,a.kt)("p",null,"After this samples can be built and flashed to the board."),(0,a.kt)("p",null,'The simplest example is to run the "Hello World" sample on the board. After changing to the directory of the Zephyr install run the following commands.'),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"west build -p always -b xiao_esp32c3 samples/hello_world\nwest flash\nwest espressif monitor\n")),(0,a.kt)("p",null,'With the final command you should see the response showing the "Hello World!" greeting.'),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"*** Booting Zephyr OS build v3.6.0-2566-gc9b45bf4672a ***\nHello World! xiao_esp32c3/esp32c3\n")),(0,a.kt)("p",null,"To assist with the process of using Zephyr with Xiao and its expansion board a repository has been constructed with several overlays and configurations used here. The commands included in this wiki article assume it is located ",(0,a.kt)("inlineCode",{parentName:"p"},"../applications/xiao-zephyr-examples")," relative to the zephyr root. An alternative path can be provided to the commands below by updating it."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"git clone https://github.com/Cosmic-Bee/xiao-zephyr-examples\n")),(0,a.kt)("h2",{id:"hardware-preparation"},"Hardware Preparation"),(0,a.kt)("table",{align:"center"},(0,a.kt)("tbody",null,(0,a.kt)("tr",null,(0,a.kt)("th",null,"Seeed Studio XIAO ESP32C3"),(0,a.kt)("th",null,"Seeed Studio Expansion Board"),(0,a.kt)("th",null,"Grove Red LED")),(0,a.kt)("tr",null,(0,a.kt)("td",null,(0,a.kt)("div",{align:"center"},(0,a.kt)("img",{src:"https://files.seeedstudio.com/wiki/XIAO_WiFi/board-pic.png",style:{width:300,height:"auto"}}))),(0,a.kt)("td",null,(0,a.kt)("div",{align:"center"},(0,a.kt)("img",{src:"https://files.seeedstudio.com/wiki/Seeeduino-XIAO-Expansion-Board/Update_pic/zheng1.jpg",style:{width:210,height:"auto"}}))),(0,a.kt)("td",null,(0,a.kt)("div",{align:"center"},(0,a.kt)("img",{src:"https://files.seeedstudio.com/wiki/Raspi_wiki/img/red_led.jpg",style:{width:210,height:"auto"}})))),(0,a.kt)("tr",null,(0,a.kt)("td",{align:"center"},(0,a.kt)("div",{class:"get_one_now_container",style:{textAlign:"center"}},(0,a.kt)("a",{class:"get_one_now_item",href:"https://www.seeedstudio.com/seeed-xiao-esp32c3-p-5431.html"},(0,a.kt)("strong",null,(0,a.kt)("span",null,(0,a.kt)("font",{color:"FFFFFF",size:"4"}," Get One Now \ud83d\uddb1\ufe0f")))))),(0,a.kt)("td",{align:"center"},(0,a.kt)("div",{class:"get_one_now_container",style:{textAlign:"center"}},(0,a.kt)("a",{class:"get_one_now_item",href:"https://www.seeedstudio.com/Seeeduino-XIAO-Expansion-board-p-4746.html"},(0,a.kt)("strong",null,(0,a.kt)("span",null,(0,a.kt)("font",{color:"FFFFFF",size:"4"}," Get One Now\ud83d\uddb1\ufe0f")))))),(0,a.kt)("td",{align:"center"},(0,a.kt)("div",{class:"get_one_now_container",style:{textAlign:"center"}},(0,a.kt)("a",{class:"get_one_now_item",href:"https://www.seeedstudio.com/Grove-Red-LED-p-1142.html"},(0,a.kt)("strong",null,(0,a.kt)("span",null,(0,a.kt)("font",{color:"FFFFFF",size:"4"}," Get One Now\ud83d\uddb1\ufe0f"))))))))),(0,a.kt)("h3",{id:"developer-knowledge"},"Developer Knowledge"),(0,a.kt)("h4",{id:"xiao-expansion-board"},"XIAO Expansion Board"),(0,a.kt)("p",null,"  In order to use Grove modules with Seeed Studio XIAO ESP32C3, we will use a ",(0,a.kt)("a",{parentName:"p",href:"https://www.seeedstudio.com/Seeeduino-XIAO-Expansion-board-p-4746.html"},"Seeed Studio Expansion Base for XIAO")," and connect XIAO ESP32C3 on it."),(0,a.kt)("p",null,"  After that, the Grove connectors on the board can be used to connect Grove modules."),(0,a.kt)("div",{style:{textAlign:"center"}},(0,a.kt)("img",{src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/C3-ESPHome-full_function/29.png",style:{width:700,height:"auto"}})),(0,a.kt)("h4",{id:"pin-definitions"},"Pin Definitions"),(0,a.kt)("p",null,"  You need to follow the graphic below to use the appropriate internal pin numbers when connecting the Grove modules to the Grove connectors on Grove Shield for Seeed Studio XIAO."),(0,a.kt)("div",{style:{textAlign:"center"}},(0,a.kt)("img",{src:"https://files.seeedstudio.com/wiki/XIAO_WiFi/pin_map-2.png",style:{width:900,height:"auto"}})),(0,a.kt)("h3",{id:"primary-functionality"},"Primary Functionality"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"GPIO / LED Enable"),(0,a.kt)("li",{parentName:"ul"},"Bluetooth"),(0,a.kt)("li",{parentName:"ul"},"Wi-Fi"),(0,a.kt)("li",{parentName:"ul"},"TFLite")),(0,a.kt)("h4",{id:"gpio--led-enable"},"GPIO / LED Enable"),(0,a.kt)("p",null,"To test this setup we can use the blinky sample with Zephyr but we'll use an additional Grove LED and an overlay to override the LED to the D0 pin to demonstrate this working (the Xiao ESP32C3 does not have a programmable onboard LED):"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"west build -p always -b xiao_esp32c3 samples/basic/blinky -- -DDTC_OVERLAY_FILE=$(dirname $(pwd))/applications/xiao-zephyr-examples/d0_led.overlay\nwest flash\nwest espressif monitor\n")),(0,a.kt)("p",null,"Double press RESET or short the RST pin to the GND."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"west flash\n")),(0,a.kt)("p",null,"You will see the attached red LED toggle on and off creating a blinking effect."),(0,a.kt)("p",null,"Let's dive into this example a bit to see why it works."),(0,a.kt)("p",null,"The associated example code reference led0:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"#define LED0_NODE DT_ALIAS(led0)\nstatic const struct gpio_dt_spec led = GPIO_DT_SPEC_GET(LED0_NODE, gpios);\n")),(0,a.kt)("p",null,"The LED overlay (",(0,a.kt)("inlineCode",{parentName:"p"},"xiao-zephyr-examples/d0_led.overlay"),") defines this LED for us:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'/ {\n    aliases {\n        led0 = &led0;\n    };\n\n    leds {\n        compatible = "gpio-leds";\n        led0: led_0 {\n            gpios = <&xiao_d 0 GPIO_ACTIVE_HIGH>;\n            label = "Demo LED";\n        };\n    };\n};\n')),(0,a.kt)("p",null,"This overlay sets D0 (as shown via ",(0,a.kt)("inlineCode",{parentName:"p"},"&xiao_d 0"),") as an LED and associates it with the alias ",(0,a.kt)("inlineCode",{parentName:"p"},"led0"),". ",(0,a.kt)("inlineCode",{parentName:"p"},"led0")," is an alias which allows many samples use it as the LED being controlled as they look specifically for this name."),(0,a.kt)("p",null,"If you monitor the serial output via ",(0,a.kt)("inlineCode",{parentName:"p"},"west espressif monitor")," you will see an output similar to:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"*** Booting Zephyr OS build v3.6.0-2566-gc9b45bf4672a ***\nLED state: OFF\nLED state: ON\nLED state: OFF\nLED state: ON\n")),(0,a.kt)("h4",{id:"bluetooth"},"Bluetooth"),(0,a.kt)("p",null,"To test this setup we can use an existing sample with Zephyr:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"west build -p always -b xiao_esp32c3 samples/bluetooth/observer\nwest flash\nwest espressif monitor\n")),(0,a.kt)("p",null,"You will see a console available for sending commands to the board:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"*** Booting Zephyr OS build v3.6.0-2566-gc9b45bf4672a ***\nStarting Observer Demo\nStarted scanning...\nDevice found: E5:44:60:88:DB:99 (random) (RSSI -92), type 0, AD data len 27\nDevice found: F3:38:F3:AD:FC:C6 (random) (RSSI -63), type 3, AD data len 8\nDevice found: 49:E6:31:0F:A6:25 (random) (RSSI -55), type 2, AD data len 28\nDevice found: EC:11:27:22:AF:D2 (public) (RSSI -80), type 0, AD data len 31\nDevice found: FB:3C:4A:AC:64:33 (random) (RSSI -78), type 0, AD data len 30\nDevice found: 79:05:36:B8:1E:1B (random) (RSSI -34), type 2, AD data len 4\nDevice found: 77:4D:FC:E2:12:D4 (random) (RSSI -86), type 2, AD data len 4\nDevice found: E0:9D:13:29:DA:15 (public) (RSSI -99), type 0, AD data len 31\nDevice found: 53:17:1B:22:70:23 (random) (RSSI -97), type 0, AD data len 18\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"CONFIG_BT=y\nCONFIG_BT_OBSERVER=y\n")),(0,a.kt)("p",null,"The ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/zephyrproject-rtos/zephyr/blob/main/samples/bluetooth/observer/prj.conf"},"conf file")," here enables bluetooth related features for the Zephyr build."),(0,a.kt)("h4",{id:"wi-fi"},"Wi-Fi"),(0,a.kt)("p",null,"To test this setup we can use an existing sample with Zephyr:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"west build -p always -b xiao_esp32c3 samples/net/wifi\nwest flash\nwest espressif monitor\n")),(0,a.kt)("p",null,"You will see a console available for sending commands to the board:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"*** Booting Zephyr OS build v3.6.0-1155-g1a55caf8263e ***\nuart:~$\n")),(0,a.kt)("p",null,"Several commands exist allowing you to see and connect to local networks, see the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/zephyrproject-rtos/zephyr/blob/main/samples/net/wifi/README.rst"},"sample readme")," for more information."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"*** Booting Zephyr OS build v3.6.0-2566-gc9b45bf4672a ***\nuart:~$ wifi scan\nScan requested\nNum  | SSID                             (len) | Chan (Band)   | RSSI | Security        | BSSID             | MFP\n1    | Maredonia                        9     | 6    (2.4GHz) | -41  | WPA2-PSK        |                   | Disable\n2    | Maredonia                        9     | 6    (2.4GHz) | -41  | WPA2-PSK        |                   | Disable\n3    | Aernazonea                       10    | 6    (2.4GHz) | -41  | WPA2-PSK        |                   | Disable\n4    | Aernazonea                       10    | 6    (2.4GHz) |\n")),(0,a.kt)("p",null,"Let's dive into this example a bit to see why it works:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'&wifi {\n    status = "okay";\n};\n')),(0,a.kt)("p",null,"The app ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/zephyrproject-rtos/zephyr/blob/main/samples/net/wifi/boards/xiao_esp32c3.overlay"},"overlay file")," is used to setup various board components. Using this file the example can be utilized as the overlay informs the sample logic to enable Wi-Fi."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"CONFIG_WIFI=y\n\nCONFIG_NETWORKING=y\nCONFIG_NET_L2_ETHERNET=y\n\nCONFIG_NET_IPV6=n\nCONFIG_NET_IPV4=y\nCONFIG_NET_DHCPV4=y\nCONFIG_ESP32_WIFI_STA_AUTO_DHCPV4=y\n\nCONFIG_NET_LOG=y\n")),(0,a.kt)("p",null,"The ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/zephyrproject-rtos/zephyr/blob/main/samples/net/wifi/boards/xiao_esp32c3.conf"},"conf file")," here enables several networking related features for the Zephyr build."),(0,a.kt)("h4",{id:"tflite---hello-world"},"TFLite - Hello World"),(0,a.kt)("p",null,"Enable TFLite with Zephyr and update:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"west config manifest.project-filter -- +tflite-micro\nwest update\n")),(0,a.kt)("p",null,"Build the sample and flash to your board:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"west build -p always -b xiao_esp32c3 samples/modules/tflite-micro/hello_world\nwest flash\nwest espressif monitor\n")),(0,a.kt)("p",null,"You will see results returned from the console:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"*** Booting Zephyr OS build v3.6.0-2566-gc9b45bf4672a ***\nx_value: 1.0*2^-127, y_value: 1.0*2^-127\n\nx_value: 1.2566366*2^-2, y_value: 1.4910772*2^-2\n\nx_value: 1.2566366*2^-1, y_value: 1.1183078*2^-1\n\nx_value: 1.8849551*2^-1, y_value: 1.677462*2^-1\n\nx_value: 1.2566366*2^0, y_value: 1.9316229*2^-1\n\nx_value: 1.5707957*2^0, y_value: 1.0420598*2^0\n\nx_value: 1.8849551*2^0, y_value: 1.9146791*2^-1\n\nx_value: 1.0995567*2^1, y_value: 1.6435742*2^-1\n\nx_value: 1.2566366*2^1, y_value: 1.0674761*2^-1\n\nx_value: 1.4137159*2^1, y_value: 1.8977352*2^-3\n")),(0,a.kt)("p",null,"Additional information about TFLite is outside of the scope of this guide but the example serves as a guide to the capabilities of the device and the components required for running the TFLite setup."),(0,a.kt)("h3",{id:"additional-components"},"Additional Components"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://www.seeedstudio.com/Seeeduino-XIAO-Expansion-board-p-4746.html"},"Grove - Expansion Board")," - I2C Display"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://www.seeedstudio.com/Seeeduino-XIAO-Expansion-board-p-4746.html"},"Grove - Expansion Board")," - Button"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://www.seeedstudio.com/Grove-Temperature-Humidity-Sensor-SHT31.html"},"Grove - Temperature and Humidity Sensor (SHT31)")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://www.seeedstudio.com/1-69inch-240-280-Resolution-IPS-LCD-Display-Module-p-5755.html"},"1.69inch LCD Display Module, 240\xd7280 Resolution, SPI Interface"))),(0,a.kt)("h4",{id:"grove---expansion-board---i2c-display"},"Grove - Expansion Board - I2C Display"),(0,a.kt)("div",{style:{textAlign:"center"}},(0,a.kt)("img",{src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/xiao_esp23c3_zephyr/xiao_expansion_oled.jpg",style:{width:600,height:"auto"}})),(0,a.kt)("p",null,"To test this setup we can use an existing sample with Zephyr:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"west build -p always -b xiao_esp32c3 samples/drivers/display --  -DSHIELD=seeed_xiao_expansion_board\nwest flash\n")),(0,a.kt)("p",null,"You'll see a display showing multiple black boxes and a blinking box in the corner given this display only supports two colors."),(0,a.kt)("p",null,"Let's dive into this example a bit to see why it works:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'/ {\n    chosen {\n      zephyr,display = &ssd1306;\n    };\n};\n\n&xiao_i2c {\n  status = "okay";\n\n  ssd1306: ssd1306@3c {\n    compatible = "solomon,ssd1306fb";\n    reg = <0x3c>;\n    width = <128>;\n    height = <64>;\n    segment-offset = <0>;\n    page-offset = <0>;\n    display-offset = <0>;\n    multiplex-ratio = <63>;\n    segment-remap;\n    com-invdir;\n    prechargep = <0x22>;\n  };\n};\n\n')),(0,a.kt)("p",null,"The shield sets up a SSD1306 OLED screen at the 0x3C register. It is selected as the zephyr display in the chosen section."),(0,a.kt)("h4",{id:"grove---expansion-board---button"},"Grove - Expansion Board - Button"),(0,a.kt)("p",null,"To test this setup we can use an existing sample with Zephyr but we'll use an additional Grove LED and an overlay to override the LED to the D0 pin to demonstrate this working (the Xiao ESP32C3 does not have a programmable onboard LED):"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"west build -p always -b xiao_esp32c3 samples/basic/button -- -DSHIELD=seeed_xiao_expansion_board -DDTC_OVERLAY_FILE=$(dirname $(pwd))/applications/xiao-zephyr-examples/d0_led.overlay\nwest flash\nwest espressif monitor\n")),(0,a.kt)("p",null,"Pressing the button with the sample will trigger the D0 associated LED to light up."),(0,a.kt)("p",null,"You will see results returned from the console:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"*** Booting Zephyr OS build v3.6.0-2566-gc9b45bf4672a ***\nSet up button at gpio@60004000 pin 3\nSet up LED at gpio@60004000 pin 2\nPress the button\nButton pressed at 39818120\nButton pressed at 63872629\nButton pressed at 168304681\nButton pressed at 241105558\nButton pressed at 346324767\nButton pressed at 382181856\nButton pressed at 419342954\n")),(0,a.kt)("p",null,"Let's dive into this example a bit to see why it works:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'/ {\n    aliases {\n      sw0 = &xiao_button0;\n    };\n\n    buttons {\n      compatible = "gpio-keys";\n      xiao_button0: button_0 {\n        gpios = <&xiao_d 1 (GPIO_PULL_UP | GPIO_ACTIVE_LOW)>;\n        label = "SW0";\n        zephyr,code = <INPUT_KEY_0>;\n      };\n    };\n};\n')),(0,a.kt)("p",null,"The shield / overlay file is used to setup various board components. Using this file the button example can be utilized as the overlay allows the Zephyr to configure the button and make it available for the associated code."),(0,a.kt)("p",null,"In this case D1 on the Xiao ESP32C3. It is setup in this overlay to act as a button and is aliased to the sw0 name to allow it to be used for the sample which has code expecting this."),(0,a.kt)("p",null,"The LED as shown above in the LED example is also configured via its overlay file. Now with the button associated pressing it lights this LED."),(0,a.kt)("div",{style:{textAlign:"center"}},(0,a.kt)("img",{src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/xiao_esp23c3_zephyr/led-button.gif",style:{width:600,height:"auto"}})),(0,a.kt)("h4",{id:"grove---expansion-board---buzzer"},"Grove - Expansion Board - Buzzer"),(0,a.kt)("p",null,"We'll activate our buzzer using the blinky PWM example to control its activation via a PWM signal. For this we'll use a custom overlay which enables the PWM for the A3 pin."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'cd ~/zephyrproject/zephyr\nwest build -p always -b xiao_esp32c3 samples/basic/blinky_pwm -- -DDTC_OVERLAY_FILE="$(dirname $(pwd))/applications/xiao-zephyr-examples/xiao-esp32c3/xiao_expansion_buzzer.overlay"\nwest flash\n')),(0,a.kt)("p",null,"After flashing you should begin hearing a series of buzzes which change in sound as the sample runs its course."),(0,a.kt)("p",null,"Let's look at why this works:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'#include <zephyr/dt-bindings/pwm/pwm.h>\n\n/ {\n    aliases {\n        pwm-0 = &ledc0;\n        pwm-led0 = &pwm_buzzer;\n    };\n\n    pwmleds {\n        compatible = "pwm-leds";\n        pwm_buzzer: pwm_led_gpio0_5 {\n            label = "PWM LED0";\n            pwms = <&ledc0 0 1000 PWM_POLARITY_NORMAL>;\n        };\n    };\n};\n\n&pinctrl {\n    ledc0_default: ledc0_default {\n        group1 {\n            pinmux = <LEDC_CH0_GPIO5>;\n            output-enable;\n        };\n    };\n};\n\n&ledc0 {\n    pinctrl-0 = <&ledc0_default>;\n    pinctrl-names = "default";\n    status = "okay";\n    #address-cells = <1>;\n    #size-cells = <0>;\n    channel0@0 {\n        reg = <0x0>;\n        timer = <0>;\n    };\n};\n')),(0,a.kt)("p",null,"The overlay configures the PWM logic for the pin 5 which corresponds with the A3 pin from the ESP32C3 pinout."),(0,a.kt)("h4",{id:"grove---expansion-board---sd-card"},"Grove - Expansion Board - SD Card"),(0,a.kt)("p",null,"We'll use the filesystem sample here along with the Xiao Expansion Board shield to try interfacing with the SD card reader over SPI. The expansion board shield has the CS pin configured for the associated ",(0,a.kt)("inlineCode",{parentName:"p"},"&xiao_d 2")," pin so no work is needed on your part for associating this capability with the board aside from adding the shield. To further prepare it we are using a custom config that enables the SD card functionality."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'cd ~/zephyrproject/zephyr\nwest build -p always -b xiao_esp32c3 samples/subsys/fs/fs_sample -- -DEXTRA_CONF_FILE="$(dirname $(pwd))/applications/xiao-zephyr-examples/xiao_expansion_sd.conf" -DSHIELD=seeed_xiao_expansion_board\n')),(0,a.kt)("p",null,"Now flash and monitor:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"west flash\nwest espressif monitor\n")),(0,a.kt)("p",null,"You should see a response similar to this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"*** Booting Zephyr OS build v3.6.0-2566-gc9b45bf4672a ***\n[00:00:00.032,000] <inf> sd: Maximum SD clock is under 25MHz, using clock of 24000000Hz\n[00:00:00.033,000] <inf> main: Block count 15519744\nSector size 512\nMemory Size(MB) 7578\nDisk mounted.\nListing dir /SD: ...\n[FILE] IMAGE1.JPG (size = 58422)\n[FILE] IMAGE2.JPG (size = 97963)\n")),(0,a.kt)("p",null,"In this case my SD card had two files. Their names and their sizes were outputted to my console."),(0,a.kt)("p",null,"Let's look over the relevant elements at play here:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"CONFIG_SPI=y\nCONFIG_DISK_DRIVER_SDMMC=y\nCONFIG_GPIO=y\n")),(0,a.kt)("p",null,"In the associated config we're enabling SPI, the SDMMC disk driver, and the GPIO. Without this config the overlay will lead to an error as the sample is unable to find the SD card."),(0,a.kt)("p",null,"The relevant part of the Xiao Expansion Board shield is shown below:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'&xiao_spi {\n    status = "okay";\n    cs-gpios = <&xiao_d 2 GPIO_ACTIVE_LOW>;\n\n    sdhc0: sdhc@0 {\n        compatible = "zephyr,sdhc-spi-slot";\n        reg = <0>;\n        status = "okay";\n        mmc {\n            compatible = "zephyr,sdmmc-disk";\n            status = "okay";\n        };\n        spi-max-frequency = <24000000>;\n    };\n};\n')),(0,a.kt)("p",null,"As mentioned previously the ",(0,a.kt)("inlineCode",{parentName:"p"},"&xiao_d 2")," pin mapping is used to allow the D2 pin to be selected for this regardless of the board used so long as it supports the ",(0,a.kt)("inlineCode",{parentName:"p"},"&xiao_d")," pin setup."),(0,a.kt)("h4",{id:"grove---temperature-and-humidity-sensor-sht31"},"Grove - Temperature and Humidity Sensor (SHT31)"),(0,a.kt)("p",null,"First solder on pins and connect your Xiao ESP32C3 to the expansion board. Then connect a grove connector cable between the Grove SHT31 and one of the I2C ports on the expansion board."),(0,a.kt)("div",{style:{textAlign:"center"}},(0,a.kt)("img",{src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/xiao_esp23c3_zephyr/xiao_sht31.jpg",style:{width:600,height:"auto"}})),(0,a.kt)("p",null,"To test this setup we can use an existing sample with Zephyr:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"west build -p always -b xiao_esp32c3 samples/sensor/sht3xd -- -DDTC_OVERLAY_FILE=$(dirname $(pwd))/applications/xiao-zephyr-examples/sht31.overlay\nwest flash\nwest espressif monitor\n")),(0,a.kt)("p",null,"You will see results returned from the console:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"*** Booting Zephyr OS build v3.6.0-2566-gc9b45bf4672a ***\nSHT3XD: 25.92 Cel ; 53.37 %RH\nSHT3XD: 25.97 Cel ; 54.37 %RH\nSHT3XD: 26.00 Cel ; 54.43 %RH\nSHT3XD: 26.02 Cel ; 54.11 %RH\nSHT3XD: 26.03 Cel ; 53.33 %RH\nSHT3XD: 26.02 Cel ; 52.88 %RH\nSHT3XD: 26.04 Cel ; 52.12 %RH\nSHT3XD: 26.07 Cel ; 51.87 %RH\nSHT3XD: 26.13 Cel ; 52.81 %RH\n")),(0,a.kt)("p",null,"Let's dive into this example a bit to see why it works:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},' &xiao_i2c {\n    sht3xd@44 {\n            compatible = "sensirion,sht3xd";\n            reg = <0x44>;\n        };\n    };\n')),(0,a.kt)("p",null,"The app overlay file is used to setup various board components. Using this file the SHT31 example can be utilized as the overlay informs the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/zephyrproject-rtos/zephyr/blob/main/samples/sensor/sht3xd/src/main.c"},"sample logic")," how to configure the sensor for our board."),(0,a.kt)("h4",{id:"169inch-lcd-display-module-240280-resolution-spi-interface"},"1.69inch LCD Display Module, 240\xd7280 Resolution, SPI Interface"),(0,a.kt)("p",null,"For this example we'll use SPI to connect to a 1.69 inch LCD with a 240x280 resolution."),(0,a.kt)("p",null,"First connect your board to the LCD screen using the following image as a guide (in this case we're using the Xiao ESP32C3 but the same pin layout is used for connecting here)."),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"1.69-inch LCD SPI Display"),(0,a.kt)("th",{parentName:"tr",align:null},"XIAO ESP32C3"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"VCC"),(0,a.kt)("td",{parentName:"tr",align:null},"3V3")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"GND"),(0,a.kt)("td",{parentName:"tr",align:null},"GND")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"DIN"),(0,a.kt)("td",{parentName:"tr",align:null},"D10")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"CLK"),(0,a.kt)("td",{parentName:"tr",align:null},"D8")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"CS"),(0,a.kt)("td",{parentName:"tr",align:null},"D1")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"DC"),(0,a.kt)("td",{parentName:"tr",align:null},"D3")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"RST"),(0,a.kt)("td",{parentName:"tr",align:null},"D0")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"BL"),(0,a.kt)("td",{parentName:"tr",align:null},"D6")))),(0,a.kt)("div",{style:{textAlign:"center"}},(0,a.kt)("img",{src:"https://files.seeedstudio.com/wiki/lcd_spi_display/10.png",style:{width:700,height:"auto"}})),(0,a.kt)("p",null,"We can now build and flash the firmware:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"cd ~/zephyrproject/zephyr\nwest build -p always -b xiao_esp32c3 samples/drivers/display -- -DDTC_OVERLAY_FILE=$(dirname $(pwd))/applications/xiao-zephyr-examples/240x280_st7789v2.overlay -DEXTRA_CONF_FILE=$(dirname $(pwd))/applications/xiao-zephyr-examples/240x280_st7789v2.conf\nwest flash\n")),(0,a.kt)("p",null,"With the new firmware in place the device now shows the same demo screen we saw previously on the expansion board just now updated for the color LCD over SPI."),(0,a.kt)("div",{style:{textAlign:"center"}},(0,a.kt)("img",{src:"https://files.seeedstudio.com/wiki/wiki-ranger/Contributions/xiao_esp23c3_zephyr/spi_lcd.jpg",style:{width:600,height:"auto"}})),(0,a.kt)("h2",{id:"-contributor-project"},"\u2728 Contributor Project"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"This project is supported by the Seeed Studio ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/orgs/Seeed-Studio/projects/6?pane=issue&itemId=57293521"},"Contributor Project"),"."),(0,a.kt)("li",{parentName:"ul"},"Thanks ",(0,a.kt)("strong",{parentName:"li"},"Tim's efforts")," and your work will be ",(0,a.kt)("a",{parentName:"li",href:"https://wiki.seeedstudio.com/Honorary-Contributors/"},"exhibited"),".")),(0,a.kt)("h2",{id:"tech-support--product-discussion"},"Tech Support & Product Discussion"),(0,a.kt)("p",null,"Thank you for choosing our products! We are here to provide you with different support to ensure that your experience with our products is as smooth as possible. We offer several communication channels to cater to different preferences and needs."),(0,a.kt)("div",{class:"button_tech_support_container"},(0,a.kt)("a",{href:"https://forum.seeedstudio.com/",class:"button_forum"}),(0,a.kt)("a",{href:"https://www.seeedstudio.com/contacts",class:"button_email"})),(0,a.kt)("div",{class:"button_tech_support_container"},(0,a.kt)("a",{href:"https://discord.gg/eWkprNDMU7",class:"button_discord"}),(0,a.kt)("a",{href:"https://github.com/Seeed-Studio/wiki-documents/discussions/69",class:"button_discussion"})))}h.isMDXComponent=!0}}]);